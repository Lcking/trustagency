# ä»»åŠ¡ B-2: é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç æ ‡å‡†åŒ–

**ä»»åŠ¡ ID**: B-2  
**ä¼˜å…ˆçº§**: P0 (å…³é”®)  
**å¤æ‚åº¦**: M (ä¸­ç­‰)  
**é¢„è®¡å·¥æ—¶**: 4-6 å°æ—¶  
**è´Ÿè´£äºº**: Backend Team  
**å¼€å§‹æ—¥æœŸ**: 2025-11-12  
**å®Œæˆæ—¥æœŸ**: 2025-11-13  
**çŠ¶æ€**: â³ å¾…å¯åŠ¨  
**ä¾èµ–**: B-1 (API å®¡è®¡)

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

å»ºç«‹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œ HTTP çŠ¶æ€ç æ ‡å‡†ï¼Œç¡®ä¿å‰åç«¯äº¤äº’æ—¶å¯¹é”™è¯¯ä¿¡æ¯çš„ç†è§£ä¸€è‡´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

---

## ğŸ¯ ç›®æ ‡

1. âœ… å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
2. âœ… å»ºç«‹é”™è¯¯ä»£ç ä½“ç³» (Error Codes)
3. âœ… æ ‡å‡†åŒ– HTTP çŠ¶æ€ç ä½¿ç”¨
4. âœ… å®ç°å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
5. âœ… åˆ›å»ºå‰ç«¯é”™è¯¯å¤„ç†æŒ‡å—

---

## ğŸ“ ä»»åŠ¡å†…å®¹

### 1. å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

**æ–‡ä»¶ä½ç½®**: `backend/app/schemas/error.py` (æ–°å»º)

```python
from enum import Enum
from typing import Optional
from datetime import datetime
from pydantic import BaseModel


class ErrorCode(str, Enum):
    """é”™è¯¯ä»£ç æšä¸¾"""
    
    # éªŒè¯é”™è¯¯ (400)
    VALIDATION_ERROR = "VALIDATION_ERROR"
    INVALID_PARAMETER = "INVALID_PARAMETER"
    MISSING_PARAMETER = "MISSING_PARAMETER"
    INVALID_FORMAT = "INVALID_FORMAT"
    
    # è®¤è¯é”™è¯¯ (401)
    UNAUTHORIZED = "UNAUTHORIZED"
    TOKEN_EXPIRED = "TOKEN_EXPIRED"
    INVALID_TOKEN = "INVALID_TOKEN"
    CREDENTIALS_INVALID = "CREDENTIALS_INVALID"
    
    # æˆæƒé”™è¯¯ (403)
    FORBIDDEN = "FORBIDDEN"
    PERMISSION_DENIED = "PERMISSION_DENIED"
    INSUFFICIENT_PRIVILEGES = "INSUFFICIENT_PRIVILEGES"
    
    # èµ„æºé”™è¯¯ (404)
    NOT_FOUND = "NOT_FOUND"
    RESOURCE_NOT_FOUND = "RESOURCE_NOT_FOUND"
    
    # å†²çªé”™è¯¯ (409)
    CONFLICT = "CONFLICT"
    DUPLICATE_ENTRY = "DUPLICATE_ENTRY"
    RESOURCE_EXISTS = "RESOURCE_EXISTS"
    
    # ä¸šåŠ¡é€»è¾‘é”™è¯¯ (422)
    BUSINESS_ERROR = "BUSINESS_ERROR"
    INVALID_STATE = "INVALID_STATE"
    OPERATION_NOT_ALLOWED = "OPERATION_NOT_ALLOWED"
    
    # æœåŠ¡å™¨é”™è¯¯ (500)
    INTERNAL_ERROR = "INTERNAL_ERROR"
    DATABASE_ERROR = "DATABASE_ERROR"
    EXTERNAL_SERVICE_ERROR = "EXTERNAL_SERVICE_ERROR"


class ErrorResponse(BaseModel):
    """é”™è¯¯å“åº”æ ¼å¼"""
    
    success: bool = False
    error_code: ErrorCode
    message: str
    details: Optional[dict] = None
    timestamp: datetime = None
    request_id: Optional[str] = None
    
    class Config:
        use_enum_values = True
        
    def __init__(self, **data):
        if data.get('timestamp') is None:
            data['timestamp'] = datetime.utcnow()
        super().__init__(**data)


class SuccessResponse(BaseModel):
    """æˆåŠŸå“åº”æ ¼å¼"""
    
    success: bool = True
    data: Optional[dict] = None
    timestamp: datetime = None
    request_id: Optional[str] = None
    
    class Config:
        use_enum_values = True
        
    def __init__(self, **data):
        if data.get('timestamp') is None:
            data['timestamp'] = datetime.utcnow()
        super().__init__(**data)
```

### 2. é”™è¯¯ä»£ç æ˜ å°„è¡¨

**æ–‡ä»¶ä½ç½®**: `docs/ERROR_CODES.md` (æ–°å»º)

```markdown
# API é”™è¯¯ä»£ç å‚è€ƒ

## æ ¼å¼

æ¯ä¸ªé”™è¯¯éƒ½åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- é”™è¯¯ä»£ç  (Error Code)
- HTTP çŠ¶æ€ç  (Status Code)
- ç”¨æˆ·æ¶ˆæ¯ (User Message)
- å¼€å‘è€…è¯´æ˜ (Developer Notes)

## éªŒè¯é”™è¯¯ (400 Bad Request)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| VALIDATION_ERROR | è¯·æ±‚æ•°æ®éªŒè¯å¤±è´¥ | è¯·æ±‚å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥ |
| INVALID_PARAMETER | å‚æ•°å€¼æ— æ•ˆ | å‚æ•° {param} å€¼æ— æ•ˆ |
| MISSING_PARAMETER | å¿…éœ€å‚æ•°ç¼ºå¤± | ç¼ºå°‘å¿…éœ€å‚æ•° {param} |
| INVALID_FORMAT | å‚æ•°æ ¼å¼ä¸æ­£ç¡® | å‚æ•° {param} æ ¼å¼ä¸æ­£ç¡® (åº”ä¸º {expected}) |

## è®¤è¯é”™è¯¯ (401 Unauthorized)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| UNAUTHORIZED | æœªè®¤è¯æˆ–è®¤è¯å¤±è´¥ | è¯·å…ˆç™»å½• |
| TOKEN_EXPIRED | Token å·²è¿‡æœŸ | ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½• |
| INVALID_TOKEN | Token æ— æ•ˆ | è®¤è¯ä¿¡æ¯æ— æ•ˆ |
| CREDENTIALS_INVALID | å‡­è¯ä¸åŒ¹é… | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |

## æˆæƒé”™è¯¯ (403 Forbidden)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| FORBIDDEN | ç¦æ­¢è®¿é—® | æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤èµ„æº |
| PERMISSION_DENIED | æƒé™ä¸è¶³ | æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ |
| INSUFFICIENT_PRIVILEGES | æƒé™ç­‰çº§ä¸è¶³ | éœ€è¦æ›´é«˜çš„æƒé™ç­‰çº§ |

## èµ„æºé”™è¯¯ (404 Not Found)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| NOT_FOUND | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ |
| RESOURCE_NOT_FOUND | æŒ‡å®šèµ„æºæœªæ‰¾åˆ° | {resource} (ID: {id}) ä¸å­˜åœ¨ |

## å†²çªé”™è¯¯ (409 Conflict)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| CONFLICT | èµ„æºå†²çª | æ“ä½œå†²çªï¼Œè¯·ç¨åé‡è¯• |
| DUPLICATE_ENTRY | é‡å¤æ¡ç›® | {field} å·²å­˜åœ¨ |
| RESOURCE_EXISTS | èµ„æºå·²å­˜åœ¨ | è¯¥èµ„æºå·²å­˜åœ¨ |

## ä¸šåŠ¡é€»è¾‘é”™è¯¯ (422 Unprocessable Entity)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| BUSINESS_ERROR | ä¸šåŠ¡é€»è¾‘é”™è¯¯ | æ“ä½œå¤±è´¥ï¼ŒåŸå› ï¼š{reason} |
| INVALID_STATE | çŠ¶æ€æ— æ•ˆ | å½“å‰çŠ¶æ€ä¸æ”¯æŒæ­¤æ“ä½œ |
| OPERATION_NOT_ALLOWED | æ“ä½œä¸å…è®¸ | ä¸å…è®¸æ‰§è¡Œæ­¤æ“ä½œ |

## æœåŠ¡å™¨é”™è¯¯ (500 Internal Server Error)

| ä»£ç  | è¯´æ˜ | ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹ |
|------|------|-----------|
| INTERNAL_ERROR | å†…éƒ¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯• |
| DATABASE_ERROR | æ•°æ®åº“é”™è¯¯ | æ•°æ®åº“æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯• |
| EXTERNAL_SERVICE_ERROR | å¤–éƒ¨æœåŠ¡é”™è¯¯ | å¤–éƒ¨æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ |

## å“åº”ç¤ºä¾‹

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "æ–‡ç« æ ‡é¢˜"
  },
  "timestamp": "2025-11-12T10:30:00",
  "request_id": "req_abc123def456"
}
```

### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error_code": "VALIDATION_ERROR",
  "message": "è¯·æ±‚å‚æ•°æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥",
  "details": {
    "field": "email",
    "reason": "invalid email format"
  },
  "timestamp": "2025-11-12T10:30:00",
  "request_id": "req_abc123def456"
}
```

## å‰ç«¯å¤„ç†æŒ‡å—

### æŒ‰çŠ¶æ€ç å¤„ç†

```javascript
function handleError(error) {
  switch (error.status) {
    case 400:
      // éªŒè¯é”™è¯¯ - æ˜¾ç¤ºå…·ä½“å­—æ®µé”™è¯¯
      showFieldErrors(error.details);
      break;
    case 401:
      // è®¤è¯é”™è¯¯ - é‡å®šå‘åˆ°ç™»å½•
      redirectToLogin();
      break;
    case 403:
      // æƒé™é”™è¯¯ - æ˜¾ç¤ºæƒé™æç¤º
      showPermissionDenied();
      break;
    case 404:
      // æœªæ‰¾åˆ° - æ˜¾ç¤º 404 é¡µé¢
      show404Page();
      break;
    case 409:
      // å†²çªé”™è¯¯ - æç¤ºç”¨æˆ·é‡è¯•æˆ–åˆ·æ–°
      showConflictDialog();
      break;
    case 422:
      // ä¸šåŠ¡é”™è¯¯ - æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æ¶ˆæ¯
      showBusinessError(error.message);
      break;
    default:
      // æœåŠ¡å™¨é”™è¯¯ - æ˜¾ç¤ºé€šç”¨é”™è¯¯æ¶ˆæ¯
      showServerError();
  }
}
```

### æŒ‰é”™è¯¯ä»£ç å¤„ç†

```javascript
function handleErrorCode(errorCode, message) {
  const errorMap = {
    'TOKEN_EXPIRED': () => {
      redirectToLogin();
      showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
    },
    'DUPLICATE_ENTRY': () => {
      showToast(message, 'error');
    },
    'PERMISSION_DENIED': () => {
      showToast('æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ', 'error');
    },
    // ... æ›´å¤šæ˜ å°„
  };
  
  if (errorMap[errorCode]) {
    errorMap[errorCode]();
  } else {
    showToast(message || 'æ“ä½œå¤±è´¥', 'error');
  }
}
```
```

### 3. å®ç°å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶

**æ–‡ä»¶ä½ç½®**: `backend/app/middleware/error_handler.py` (æ–°å»º)

```python
import uuid
from fastapi import FastAPI, Request, status
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError
from sqlalchemy.exc import SQLAlchemyError
import logging

from app.schemas.error import ErrorResponse, ErrorCode


logger = logging.getLogger(__name__)


def add_error_handlers(app: FastAPI):
    """ä¸º FastAPI åº”ç”¨æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†"""
    
    # è¯·æ±‚ ID ä¸­é—´ä»¶
    @app.middleware("http")
    async def add_request_id(request: Request, call_next):
        request.state.request_id = str(uuid.uuid4())
        response = await call_next(request)
        response.headers["X-Request-ID"] = request.state.request_id
        return response
    
    # éªŒè¯é”™è¯¯å¤„ç†
    @app.exception_handler(RequestValidationError)
    async def validation_exception_handler(request: Request, exc: RequestValidationError):
        request_id = getattr(request.state, 'request_id', None)
        
        # æå–ç¬¬ä¸€ä¸ªé”™è¯¯ç”¨äºå±•ç¤º
        first_error = exc.errors()[0]
        field = '.'.join(str(x) for x in first_error['loc'][1:])
        reason = first_error['msg']
        
        logger.warning(f"Validation error: {field} - {reason} [Request ID: {request_id}]")
        
        error_response = ErrorResponse(
            error_code=ErrorCode.VALIDATION_ERROR,
            message=f"è¯·æ±‚å‚æ•°æœ‰è¯¯ï¼š{field}",
            details={
                "field": field,
                "errors": exc.errors()
            },
            request_id=request_id
        )
        
        return JSONResponse(
            status_code=status.HTTP_400_BAD_REQUEST,
            content=error_response.dict()
        )
    
    # é€šç”¨å¼‚å¸¸å¤„ç†
    @app.exception_handler(Exception)
    async def general_exception_handler(request: Request, exc: Exception):
        request_id = getattr(request.state, 'request_id', None)
        
        # æ•°æ®åº“é”™è¯¯
        if isinstance(exc, SQLAlchemyError):
            logger.error(f"Database error: {str(exc)} [Request ID: {request_id}]")
            error_response = ErrorResponse(
                error_code=ErrorCode.DATABASE_ERROR,
                message="æ•°æ®åº“æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",
                request_id=request_id
            )
            return JSONResponse(
                status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
                content=error_response.dict()
            )
        
        # å…¶ä»–æœªé¢„æœŸçš„é”™è¯¯
        logger.error(f"Unhandled exception: {str(exc)} [Request ID: {request_id}]", exc_info=True)
        error_response = ErrorResponse(
            error_code=ErrorCode.INTERNAL_ERROR,
            message="æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•",
            request_id=request_id
        )
        
        return JSONResponse(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            content=error_response.dict()
        )
    
    return app


class APIException(Exception):
    """è‡ªå®šä¹‰ API å¼‚å¸¸"""
    
    def __init__(
        self,
        error_code: ErrorCode,
        message: str,
        status_code: int = status.HTTP_400_BAD_REQUEST,
        details: dict = None
    ):
        self.error_code = error_code
        self.message = message
        self.status_code = status_code
        self.details = details or {}
        super().__init__(message)


def add_api_exception_handler(app: FastAPI):
    """æ·»åŠ  APIException å¤„ç†"""
    
    @app.exception_handler(APIException)
    async def api_exception_handler(request: Request, exc: APIException):
        request_id = getattr(request.state, 'request_id', None)
        
        logger.warning(f"API exception: {exc.error_code} - {exc.message} [Request ID: {request_id}]")
        
        error_response = ErrorResponse(
            error_code=exc.error_code,
            message=exc.message,
            details=exc.details,
            request_id=request_id
        )
        
        return JSONResponse(
            status_code=exc.status_code,
            content=error_response.dict()
        )
    
    return app
```

### 4. åœ¨ FastAPI åº”ç”¨ä¸­é›†æˆé”™è¯¯å¤„ç†

**æ–‡ä»¶ä½ç½®**: `backend/app/main.py` (ä¿®æ”¹)

```python
# åœ¨ FastAPI åº”ç”¨åˆå§‹åŒ–åæ·»åŠ 

from app.middleware.error_handler import add_error_handlers, add_api_exception_handler

app = FastAPI(...)

# æ·»åŠ é”™è¯¯å¤„ç†
add_error_handlers(app)
add_api_exception_handler(app)
```

### 5. æ›´æ–°ç°æœ‰è·¯ç”±ä»¥ä½¿ç”¨æ–°çš„é”™è¯¯å¤„ç†

**ç¤ºä¾‹**: `backend/app/routes/articles.py`

```python
from fastapi import APIRouter, Depends, status
from sqlalchemy.orm import Session

from app.middleware.error_handler import APIException
from app.schemas.error import ErrorCode
from app.database import get_db
from app.models import Article


router = APIRouter(prefix="/api/articles", tags=["Articles"])


@router.get("/{article_id}")
async def get_article(article_id: int, db: Session = Depends(get_db)):
    """è·å–å•ç¯‡æ–‡ç« """
    
    # éªŒè¯å‚æ•°
    if article_id <= 0:
        raise APIException(
            error_code=ErrorCode.INVALID_PARAMETER,
            message="æ–‡ç«  ID å¿…é¡»æ˜¯æ­£æ•°",
            status_code=status.HTTP_400_BAD_REQUEST,
            details={"field": "article_id", "value": article_id}
        )
    
    # æŸ¥è¯¢æ–‡ç« 
    article = db.query(Article).filter(Article.id == article_id).first()
    
    if not article:
        raise APIException(
            error_code=ErrorCode.RESOURCE_NOT_FOUND,
            message=f"æ–‡ç«  (ID: {article_id}) ä¸å­˜åœ¨",
            status_code=status.HTTP_404_NOT_FOUND,
            details={"resource": "Article", "id": article_id}
        )
    
    return {"success": True, "data": article}


@router.post("", status_code=status.HTTP_201_CREATED)
async def create_article(article_data: dict, db: Session = Depends(get_db)):
    """åˆ›å»ºæ–‡ç« """
    
    # æ£€æŸ¥é‡å¤
    existing = db.query(Article).filter(Article.slug == article_data.get("slug")).first()
    
    if existing:
        raise APIException(
            error_code=ErrorCode.DUPLICATE_ENTRY,
            message="è¯¥æ–‡ç«  slug å·²å­˜åœ¨",
            status_code=status.HTTP_409_CONFLICT,
            details={"field": "slug", "value": article_data.get("slug")}
        )
    
    # åˆ›å»ºæ–‡ç« 
    article = Article(**article_data)
    db.add(article)
    db.commit()
    db.refresh(article)
    
    return {"success": True, "data": article}
```

### 6. åˆ›å»ºå‰ç«¯é”™è¯¯å¤„ç†æŒ‡å—

**æ–‡ä»¶ä½ç½®**: `docs/FRONTEND_ERROR_HANDLING.md` (æ–°å»º)

```markdown
# å‰ç«¯é”™è¯¯å¤„ç†æŒ‡å—

## é”™è¯¯æ‹¦æˆªå™¨

åˆ›å»ºä¸€ä¸ªå…¨å±€çš„ API é”™è¯¯æ‹¦æˆªå™¨æ¥ç»Ÿä¸€å¤„ç†æ‰€æœ‰é”™è¯¯ï¼š

### Axios æ‹¦æˆªå™¨ç¤ºä¾‹

\`\`\`javascript
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8001',
  timeout: 10000,
});

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  response => response,
  error => {
    const response = error.response;
    
    // æå–é”™è¯¯ä¿¡æ¯
    const errorCode = response?.data?.error_code;
    const message = response?.data?.message;
    const requestId = response?.data?.request_id;
    
    // è®°å½•é”™è¯¯
    console.error('API Error', {
      code: errorCode,
      message: message,
      status: response?.status,
      requestId: requestId
    });
    
    // æ ¹æ®ä¸åŒçš„é”™è¯¯å¤„ç†
    handleError(response?.status, errorCode, message);
    
    return Promise.reject({
      error_code: errorCode,
      message: message,
      status: response?.status,
      request_id: requestId
    });
  }
);

function handleError(status, errorCode, message) {
  switch (status) {
    case 401:
      // Token è¿‡æœŸï¼Œæ¸…é™¤å¹¶é‡å®šå‘åˆ°ç™»å½•
      localStorage.removeItem('token');
      window.location.href = '/login';
      break;
    
    case 403:
      // æƒé™ä¸è¶³
      showToast('æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ', 'error');
      break;
    
    case 404:
      // èµ„æºä¸å­˜åœ¨
      showToast('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨', 'error');
      break;
    
    case 409:
      // å†²çªï¼Œå¦‚é‡å¤æ•°æ®
      showToast(message, 'warning');
      break;
    
    case 422:
      // ä¸šåŠ¡é€»è¾‘é”™è¯¯
      showToast(message, 'error');
      break;
    
    case 500:
      // æœåŠ¡å™¨é”™è¯¯
      showToast('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
      break;
    
    default:
      showToast(message || 'è¯·æ±‚å¤±è´¥', 'error');
  }
}

export default api;
\`\`\`

## è¡¨å•éªŒè¯é”™è¯¯å¤„ç†

å½“æœåŠ¡å™¨è¿”å› 400 éªŒè¯é”™è¯¯æ—¶ï¼Œå‰ç«¯åº”è¯¥æ˜¾ç¤ºå­—æ®µçº§çš„é”™è¯¯ä¿¡æ¯ï¼š

\`\`\`javascript
async function submitForm(formData) {
  try {
    const response = await api.post('/api/articles', formData);
    showToast('åˆ›å»ºæˆåŠŸ', 'success');
    return response.data;
  } catch (error) {
    if (error.status === 400 && error.error_code === 'VALIDATION_ERROR') {
      // æ˜¾ç¤ºå­—æ®µé”™è¯¯
      const errors = error.details?.errors || [];
      errors.forEach(err => {
        const field = err.loc[err.loc.length - 1];
        showFieldError(field, err.msg);
      });
    } else {
      showToast(error.message, 'error');
    }
  }
}
\`\`\`

## é‡è¯•é€»è¾‘

æŸäº›é”™è¯¯åº”è¯¥è‡ªåŠ¨é‡è¯•ï¼š

\`\`\`javascript
async function apiCallWithRetry(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      // æŸäº›é”™è¯¯ä¸åº”è¯¥é‡è¯•
      if ([400, 401, 403, 404, 409].includes(error.status)) {
        throw error;
      }
      
      // æœ€åä¸€æ¬¡ä¹Ÿå¤±è´¥äº†
      if (i === maxRetries - 1) {
        throw error;
      }
      
      // ç­‰å¾…åé‡è¯• (æŒ‡æ•°é€€é¿)
      const delay = Math.pow(2, i) * 1000;
      await sleep(delay);
    }
  }
}
\`\`\`

## é”™è¯¯ç›‘æ§

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”è¯¥ç›‘æ§å’Œè®°å½•æ‰€æœ‰é”™è¯¯ï¼š

\`\`\`javascript
function logError(error) {
  const errorData = {
    timestamp: new Date().toISOString(),
    url: window.location.href,
    error_code: error.error_code,
    message: error.message,
    status: error.status,
    request_id: error.request_id,
    user_agent: navigator.userAgent,
    stack_trace: error.stack
  };
  
  // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
  fetch('/api/logs/error', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(errorData)
  });
}
\`\`\`
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### æ¶æ„å®Œæ•´æ€§
- [ ] é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€
- [ ] é”™è¯¯ä»£ç ä½“ç³»å®Œæ•´
- [ ] HTTP çŠ¶æ€ç ä½¿ç”¨æ­£ç¡®
- [ ] å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶å·¥ä½œæ­£å¸¸
- [ ] Request ID ç”Ÿæˆå’Œä¼ é€’

### å®ç°å®Œæ•´æ€§
- [ ] æ‰€æœ‰ç°æœ‰è·¯ç”±éƒ½ä½¿ç”¨æ–°çš„é”™è¯¯å¤„ç†
- [ ] ä½¿ç”¨äº†è‡ªå®šä¹‰ APIException
- [ ] æ—¥å¿—è®°å½•æ­£ç¡®
- [ ] ä¸ä¼šæš´éœ²æ•æ„Ÿçš„å †æ ˆè·Ÿè¸ª

### æ–‡æ¡£å®Œæ•´æ€§
- [ ] é”™è¯¯ä»£ç å‚è€ƒæ–‡æ¡£å®Œæˆ
- [ ] å‰ç«¯é”™è¯¯å¤„ç†æŒ‡å—å®Œæˆ
- [ ] åŒ…å« 5+ ä¸ªå®é™…ä½¿ç”¨ç¤ºä¾‹
- [ ] åŒ…å«é”™è¯¯æµç¨‹å›¾

### æµ‹è¯•éªŒè¯
- [ ] æ‰€æœ‰é”™è¯¯æƒ…å†µéƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
- [ ] å¯ä»¥æ­£ç¡®æ•è·å’Œå¤„ç†å¼‚å¸¸
- [ ] Request ID å¯ä»¥è¿½è¸ªé”™è¯¯
- [ ] å‰åç«¯é”™è¯¯å¤„ç†ä¸€è‡´

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

éœ€è¦åˆ›å»ºæˆ–ä¿®æ”¹çš„æ–‡ä»¶ï¼š

```
backend/
  â”œâ”€â”€ app/
  â”‚   â”œâ”€â”€ schemas/
  â”‚   â”‚   â””â”€â”€ error.py (æ–°å»º)
  â”‚   â”œâ”€â”€ middleware/
  â”‚   â”‚   â””â”€â”€ error_handler.py (æ–°å»º)
  â”‚   â”œâ”€â”€ main.py (ä¿®æ”¹ - æ·»åŠ é”™è¯¯å¤„ç†)
  â”‚   â””â”€â”€ routes/
  â”‚       â”œâ”€â”€ articles.py (ä¿®æ”¹ - ä½¿ç”¨æ–°é”™è¯¯å¤„ç†)
  â”‚       â”œâ”€â”€ users.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ categories.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ sections.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ auth.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ upload.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ ai_configs.py (ä¿®æ”¹)
  â”‚       â”œâ”€â”€ platforms.py (ä¿®æ”¹)
  â”‚       â””â”€â”€ tasks.py (ä¿®æ”¹)
  â””â”€â”€ ...

docs/
  â”œâ”€â”€ ERROR_CODES.md (æ–°å»º)
  â””â”€â”€ FRONTEND_ERROR_HANDLING.md (æ–°å»º)
```

---

## ğŸ”§ å®æ–½æ­¥éª¤

### Day 1 (å‘¨äºŒ) - ä¸Šåˆ

1. **9:00-9:30**: åˆ›å»ºé”™è¯¯å“åº” Schema
2. **9:30-10:00**: ç¼–å†™é”™è¯¯ä»£ç æšä¸¾
3. **10:00-11:00**: å®ç°é”™è¯¯å¤„ç†ä¸­é—´ä»¶
4. **11:00-12:00**: é›†æˆåˆ° FastAPI åº”ç”¨

### Day 1 (å‘¨äºŒ) - ä¸‹åˆ

5. **13:00-14:00**: æ›´æ–°ç°æœ‰è·¯ç”±
6. **14:00-15:00**: åˆ›å»ºæ–‡æ¡£
7. **15:00-16:00**: æµ‹è¯•å’ŒéªŒè¯

### Day 2 (å‘¨ä¸‰) - ä¸Šåˆ

8. **9:00-10:00**: ä¿®å¤å‘ç°çš„é—®é¢˜
9. **10:00-11:00**: æœ€ç»ˆå®¡æŸ¥
10. **11:00-12:00**: æäº¤ä»£ç 

---

## ğŸ¯ å®Œæˆåçš„é¢„æœŸæˆæœ

1. âœ… ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
   - æ‰€æœ‰é”™è¯¯éƒ½éµå¾ªåŒä¸€ä¸ªæ ¼å¼
   - åŒ…å«é”™è¯¯ä»£ç ã€æ¶ˆæ¯ã€è¯¦æƒ…å’Œ Request ID
   - ä¾¿äºå‰ç«¯è§£æå’Œå¤„ç†

2. âœ… å®Œæ•´çš„é”™è¯¯ä»£ç ä½“ç³»
   - è¦†ç›–æ‰€æœ‰å¯èƒ½çš„é”™è¯¯æƒ…å†µ
   - é”™è¯¯ä»£ç å…·æœ‰æè¿°æ€§
   - ä¾¿äºå®šä½å’Œè§£å†³é—®é¢˜

3. âœ… æ­£ç¡®çš„ HTTP çŠ¶æ€ç ä½¿ç”¨
   - éµå¾ª REST è§„èŒƒ
   - ä¾¿äºå®¢æˆ·ç«¯å’Œä»£ç†æ­£ç¡®å¤„ç†
   - æ”¹å–„ç¼“å­˜å’Œç›‘æ§

4. âœ… å…¨å±€é”™è¯¯å¤„ç†
   - å‡å°‘é‡å¤ä»£ç 
   - ç¡®ä¿ä¸€è‡´æ€§
   - æ”¹å–„ç”¨æˆ·ä½“éªŒ

---

## ğŸ“ æ¥ä¸‹æ¥

å®Œæˆæœ¬ä»»åŠ¡åï¼š
1. å¯ä»¥è¿›è¡Œ B-3 (æ•°æ®éªŒè¯)
2. ä¸º B-4 (å‰ç«¯ API å®¢æˆ·ç«¯) æä¾›åŸºç¡€
3. å®Œæˆ Phase 1 çš„æœ€åä¸€ä¸ªä»»åŠ¡

---

**ä»»åŠ¡ç¼–å·**: B-2  
**ä¼˜å…ˆçº§**: P0  
**çŠ¶æ€**: â³ å¾…å¯åŠ¨  
**é¢„è®¡å®Œæˆ**: 2025-11-13  
**æœ€åæ›´æ–°**: 2025-11-12
