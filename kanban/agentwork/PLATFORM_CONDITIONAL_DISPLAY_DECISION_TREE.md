# 平台字段条件显示 - 决策树

## 您的选择

```
是否要实现平台字段的条件显示/隐藏？
│
├─ 是 → 选择哪个方案？
│       │
│       ├─ 方案 A (最小化)
│       │   ├─ 时间: 1-2h
│       │   ├─ 风险: 高 ⚠️
│       │   └─ 结论: 不推荐 ❌
│       │
│       ├─ 方案 B (中等) ⭐ 推荐
│       │   ├─ 时间: 4-6h
│       │   ├─ 风险: 中
│       │   └─ 优点: 快速 + 正确 + 为后续准备
│       │
│       └─ 方案 C (完整)
│           ├─ 时间: 12-16h
│           ├─ 风险: 低
│           └─ 优点: 完整解决 + 架构优秀
│
└─ 否 → 暂时搁置
    └─ 保持现状: 平台字段总是显示 + 必填
    └─ 后续激活时按方案 B 推进
```

---

## 场景分析

### 场景 1: 用户想快速修复这个问题

```
现状: 平台总是显示，无法隐藏
    ↓
方案 B (4-6h)
    ↓
结果: 
  ✅ 百科栏目 → 平台字段隐藏
  ✅ 验证栏目 → 平台字段显示 + 必填
  ✅ 数据正确保存
  ✅ 为后续完整重构准备基础
```

### 场景 2: 用户想一次性解决所有问题

```
现状: 平台、分类、AI 任务都需要改造
    ↓
方案 C (12-16h) = 方案 B + A-15 完整重构
    ↓
结果:
  ✅ 栏目管理系统完整
  ✅ 分类系统完整
  ✅ AI 任务系统完整
  ✅ 前后端 UI 完整改造
  ✅ 一周内全部完成
```

### 场景 3: 用户现在没时间处理，暂时搁置

```
现状: 平台字段总是显示 + 必填
    ↓
什么都不做，继续现状
    ↓
后续激活时:
  按方案 B 推进 (4-6h)
  或
  升级为方案 C (12-16h)
```

---

## 技术实现路线图

### 方案 B 实现步骤

```
Step 1: 数据库 (0.5h)
├─ 创建 sections 表
│  └─ 4 条记录 (FAQ, Wiki, Guide, Review)
├─ 改造 articles 表
│  ├─ 新增 section_id (FK)
│  ├─ 改造 category → category_id (FK)
│  └─ platform_id 改为 NULLABLE
└─ 数据迁移

Step 2: 后端 (2h)
├─ 新建 Section Model
├─ 改造 ArticleCreate Schema
│  └─ 新增 section_id, 改造 category_id
├─ 改造 Article Create Route
│  └─ 添加条件逻辑:
│     if section.requires_platform:
│        platform_id 必填
│     else:
│        platform_id 设为 NULL
└─ 改造 ArticleService

Step 3: 前端 (1.5-2h)
├─ 添加栏目选择下拉
│  └─ <select id="articleSection" onchange="onSectionChanged()">
├─ 添加平台字段容器 (默认隐藏)
│  └─ <div id="platformFieldGroup" style="display:none;">
├─ 实现 onSectionChanged() 函数
│  └─ 根据 section.requires_platform 显示/隐藏
└─ 更新 saveArticle() 函数
   └─ 发送 section_id, category_id

Step 4: 测试 (1h)
├─ 百科栏目: 不显示平台字段 ✓
├─ 验证栏目: 显示平台字段 ✓
├─ 创建文章: 数据正确保存 ✓
└─ 编辑/删除: 正常工作 ✓
```

### 方案 C 实现路线

```
方案 B 基础
    ↓
+ A-15.1: 完整数据库设计 (section ↔ category 层级)
+ A-15.2: 栏目管理 API 完整 CRUD
+ A-15.3: 分类管理 API (支持按栏目过滤)
+ A-15.4: 文章管理 API 完整改造
+ A-15.5: AI 任务 API 完整重构 (API 配置、模板、错误处理)
+ A-15.6-9: 前端 UI 完整重构 (栏目、分类、文章、AI 任务)
+ A-15.10: 集成测试 (E2E 工作流)
    ↓
结果: 完整的栏目分类体系 + AI 生成系统
```

---

## 决策矩阵

| 指标 | 方案 A | 方案 B | 方案 C |
|------|--------|--------|--------|
| **实现时间** | 1-2h | 4-6h | 12-16h |
| **代码质量** | 👎 差 | 👍 好 | 👍👍 优秀 |
| **数据一致性** | ❌ 否 | ✅ 是 | ✅✅ 完整 |
| **可维护性** | ❌ 差 | 👍 好 | 👍👍 优秀 |
| **技术债务** | 📈 高 | 📉 低 | ✅ 无 |
| **后续扩展** | 🚧 困难 | ✅ 容易 | ✅✅ 很容易 |
| **推荐程度** | ❌ 不推荐 | ⭐ **强烈推荐** | ✅ 可选 |

---

## 用户影响评估

### 如果选择方案 B:

**好处** ✅:
- 平台字段正确地条件显示/隐藏
- 用户体验改善
- 数据完整性保证
- 不影响现有数据

**风险** ⚠️:
- 需要数据库迁移（可回滚）
- 现有数据需要补充 section_id

**缓解措施**:
- 提前备份数据库
- 分步迁移
- 充分测试
- 有回滚方案

---

### 如果选择方案 C:

**好处** ✅:
- 一次性完全解决问题
- 获得现代化的架构
- 完整的栏目分类系统
- 完整的 AI 生成系统

**风险** ⚠️:
- 工作量大
- 涉及面广
- 需要充分测试
- 实施周期长

**缓解措施**:
- 分阶段实施（通常 1.5-2 天完成）
- 充分的单元测试
- E2E 测试覆盖
- 逐步上线

---

## 时间线预估

### 方案 B (今天)

```
09:00 - 09:30  数据库设计和迁移 (30min)
09:30 - 11:00  后端代码改造 (1.5h)
11:00 - 12:00  前端 UI 和 JS (1h)
12:00 - 13:00  测试和调试 (1h)
────────────────────────────────────
合计: 4-5 小时（可在今天完成）
```

### 方案 C (分两天)

```
第 1 天 (6-8h):
  - A-15.1: 数据库设计 (2-3h)
  - A-15.2: 栏目 API (1-2h)
  - A-15.3: 分类 API (1-2h)
  - A-15.4: 文章 API (1-1.5h)

第 2 天 (6-8h):
  - A-15.5: AI 任务 API (2-3h)
  - A-15.6-9: 前端 UI (3-4h)
  - A-15.10: 测试和文档 (1-2h)

────────────────────────────────────
合计: 12-16 小时（可在 1.5-2 天完成）
```

---

## 文档清单

已生成的决策文档:

1. **`PLATFORM_CONDITIONAL_DISPLAY_ANALYSIS.md`** 📘
   - 完整的技术分析
   - 根本原因诊断
   - 三个方案详细对比

2. **`PLATFORM_CONDITIONAL_DISPLAY_DECISION.md`** 📋
   - 简明决策说明
   - 方案对比摘要
   - 工作量估算

3. **`SECTION_CATEGORY_REFACTOR_PLAN.md`** 📗
   - 完整重构规划 (A-15 系列)
   - 10 个主要任务
   - 依赖关系和时间线

4. **`kanban/issues/A-15.md`** 🎯
   - Kanban 任务卡
   - 每个任务的详细子任务
   - 验收标准和风险评估

---

## 💬 下一步

请告诉我您的选择:

**Option 1**: 🟢 立即推进方案 B
```bash
"好的，立即开始方案 B"
→ 我会立即开始修改数据库、后端、前端
→ 预计 4-6 小时完成
```

**Option 2**: 🔵 暂时搁置
```bash
"暂时搁置，保持现状"
→ 我会记录这个需求
→ 后续激活时按方案 B 推进
```

**Option 3**: 🟠 升级为方案 C
```bash
"一次性做完整重构"
→ 我会基于 A-15 计划立即开始
→ 预计 12-16 小时（1.5-2 天）完成
```

**Option 4**: 📝 先讨论细节
```bash
"我需要了解更多..."
→ 我会详细解答您的问题
```

等待您的反馈！

