# 完整功能测试指南

## 快速开始

### 1. 启动后端服务
```bash
cd /Users/ck/Desktop/Project/trustagency/backend
bash start_backend.sh
```

后端将在 `http://localhost:8001` 启动

### 2. 登录后台管理系统

访问: **http://localhost:8001/admin/**

使用凭证:
- 用户名: `admin`
- 密码: `newpassword123`

---

## 功能测试检查清单

### ✅ 测试 1: 菜单导航

**步骤:**
1. 登录后台
2. 查看左侧菜单

**预期:**
- [x] 菜单项按顺序显示:
  - 仪表板
  - 平台管理
  - 文章管理
  - AI任务
  - AI配置
  - **⚙️ 系统设置** ← 新增
  - 退出登录

**状态:** _等待你验证_

---

### ✅ 测试 2: 系统设置页面

**步骤:**
1. 登录后台
2. 点击左侧菜单 "⚙️ 系统设置"

**预期:**
- [x] 页面显示 "⚙️ 系统设置" 标题
- [x] 显示 "修改管理员密码" 部分
- [x] 显示表单包含三个字段:
  - 旧密码输入框
  - 新密码输入框 (至少8个字符)
  - 确认新密码输入框

**状态:** _等待你验证_

---

### ✅ 测试 3: 密码修改流程

**步骤:**
1. 在系统设置页面中
2. 输入旧密码: `newpassword123`
3. 输入新密码: `test123456`
4. 确认新密码: `test123456`
5. 点击 "✅ 更改密码" 按钮

**预期:**
- [x] 显示成功提示: "✅ 密码修改成功，3秒后将自动退出登录"
- [x] 3秒后自动退出登录
- [x] 跳回登录页面

**验证新密码:**
1. 登录页面输入:
   - 用户名: `admin`
   - 密码: `test123456`
2. 应该成功登录

**状态:** _等待你验证_

---

### ✅ 测试 4: 批量生成表单 - 基础功能

**步骤:**
1. 登录后台 (密码已改为 `test123456`)
2. 点击左侧菜单 "AI任务"
3. 向下滚动找到 "📝 批量生成文章" 部分

**预期:**
- [x] 表单显示以下字段:
  - "选择栏目" 下拉菜单 (显示: FAQ, Wiki, Guide, Review)
  - "选择分类" 下拉菜单 (初始空)
  - "选择平台" 下拉菜单 (默认隐藏)
  - 文章数量输入框
  - "选择AI配置" 下拉菜单

**状态:** _等待你验证_

---

### ✅ 测试 5: 批量生成表单 - 平台条件显示

**步骤:**
1. 在 "AI任务" 页面
2. 点击 "选择栏目" 下拉菜单，选择 **"验证"** (Review)
3. 观察 "选择平台" 字段

**预期:**
- [x] "选择平台" 字段应该 **显示** (因为 Review 栏目需要平台)
- [x] 显示可用平台: AlphaLeverage, BetaMargin 等

**然后:**
4. 选择 **"常见问题"** (FAQ)
5. 观察 "选择平台" 字段

**预期:**
- [x] "选择平台" 字段应该 **隐藏** (因为 FAQ 栏目不需要平台)

**状态:** _等待你验证_

---

### ✅ 测试 6: 批量生成表单 - 分类加载

**步骤:**
1. 在 "AI任务" 页面
2. 点击 "选择栏目"，选择 **"常见问题"** (FAQ)
3. 点击 "选择分类" 下拉菜单

**预期:**
- [x] 应该动态加载该栏目的所有分类
- [x] 分类来自数据库中该栏目的现有文章
- [x] 列表按字母顺序排序

**注意:** 如果 FAQ 栏目暂时没有文章，分类列表会是空的，这是正常的。

**状态:** _等待你验证_

---

### ✅ 测试 7: 完整批量生成流程 (可选)

**步骤:**
1. 在 "AI任务" 页面
2. 选择栏目: "常见问题"
3. 输入文章数量: 2
4. 点击 "📝 生成文章" 按钮

**预期:**
- [x] 提交请求到后端
- [x] 显示任务 ID 和进度
- [x] 文章开始生成

**注意:** 如果没有配置 OpenAI 密钥，此步骤可能会失败。

**状态:** _可选验证_

---

## 问题排查

### 问题: 菜单中看不到"系统设置"

**解决:**
1. 刷新页面 (Ctrl+Shift+R 或 Cmd+Shift+R)
2. 清除浏览器缓存
3. 检查后端服务是否仍在运行

### 问题: 登录后页面空白

**解决:**
1. 检查浏览器控制台是否有 JavaScript 错误
2. 打开开发者工具 (F12 或 右键 → 检查)
3. 查看 Console 标签页中的错误信息

### 问题: 密码修改提交后没有反应

**解决:**
1. 打开浏览器开发者工具的 Network 标签页
2. 提交表单并查看是否有网络请求失败
3. 检查后端是否返回 422 或其他错误

### 问题: "选择平台"字段总是显示或总是隐藏

**解决:**
1. 检查栏目是否正确配置了 `requires_platform` 属性
2. 在浏览器控制台执行: `console.log(document.getElementById('taskPlatformGroup').style.display)`
3. 查看实际值是否为 'block' 或 'none'

---

## 快速恢复密码

如果忘记新密码，可以调用重置端点:

```bash
curl -X POST http://localhost:8001/api/debug/reset-admin-password
```

这会将密码重置为 `admin123`

---

## 关键 API 端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/admin/login` | POST | 管理员登录 |
| `/api/admin/change-password` | POST | 修改密码 |
| `/api/sections` | GET | 获取所有栏目 |
| `/api/articles` | GET | 获取文章列表 |
| `/api/tasks/submit` | POST | 提交批量生成任务 |
| `/api/ai-configs` | GET | 获取AI配置列表 |

---

## 结论

✅ **所有功能已实现并同步**

系统已准备好进行完整的功能测试。请按照上述步骤逐一验证每个功能。

如有任何问题，请提供:
1. 错误信息或截图
2. 浏览器控制台的错误日志
3. 网络请求的详细信息

---

*准备日期: 2025-11-09*
*测试环境: 本地开发*
