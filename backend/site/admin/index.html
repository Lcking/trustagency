<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustAgency 后台管理系统</title>
    <!-- Marked.js - Markdown 解析器 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Tiptap 编辑器 CDN -->
    <link rel="stylesheet" href="https://unpkg.com/tiptap-default-styles@1.0.0/style.css">
    <!-- Admin CSS (提取自内联样式) -->
    <link rel="stylesheet" href="/admin/assets/css/admin.css">
    <!-- Tiptap 编辑器 - 使用官方推荐的 esm.sh CDN -->
    <link rel="stylesheet" href="https://unpkg.com/tiptap-default-styles@1.0.0/style.css">
    
    <script type="module">
    // 使用 esm.sh CDN 加载 Tiptap（官方推荐方案）
    // 使用明确的版本号以确保兼容性
    try {
        // 参考官方文档：https://tiptap.dev/guide/install/cdn
        const { Editor } = await import('https://esm.sh/@tiptap/core@2.4.0');
        const StarterKit = (await import('https://esm.sh/@tiptap/starter-kit@2.4.0')).default;
        
        // 暴露到全局作用域供其他脚本使用
        window.TiptapEditor = Editor;
        window.TiptapStarterKit = StarterKit;
        
        console.log('✅ Tiptap 库已通过 esm.sh CDN 加载成功');
        console.log('✅ Editor available:', !!window.TiptapEditor);
        console.log('✅ StarterKit available:', !!window.TiptapStarterKit);
    } catch (error) {
        console.error('❌ Tiptap 库加载失败:', error);
        console.error('错误详情:', error.message);
        // 不阻止页面加载，编辑器初始化时会有降级方案
    }
    </script>

</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <h1>🔐 后台登录</h1>
            <div id="loginError" class="error" style="display: none;"></div>
            <form id="loginForm" method="POST" action="javascript:void(0);">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">登 录</button>
            </form>
        </div>
    </div>

    <!-- 主页面 -->
    <div id="mainPage" class="container" style="display: none;">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <h1>TrustAgency</h1>
            <ul>
                <li><a href="#" onclick="showSection('dashboard')" class="menu-item active" data-section="dashboard">仪表板</a></li>
                <li><a href="#" onclick="showSection('sections')" class="menu-item" data-section="sections">栏目管理</a></li>
                <li><a href="#" onclick="showSection('platforms')" class="menu-item" data-section="platforms">平台管理</a></li>
                <li><a href="#" onclick="showSection('articles')" class="menu-item" data-section="articles">文章管理</a></li>
                <li><a href="#" onclick="showSection('tasks')" class="menu-item" data-section="tasks">AI任务</a></li>
                <li><a href="#" onclick="showSection('ai-configs')" class="menu-item" data-section="ai-configs">AI配置</a></li>
                <li><a href="#" onclick="showSection('settings')" class="menu-item" data-section="settings">系统设置</a></li>
                <li><a href="#" onclick="logout()" class="menu-item" style="margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 20px;">退出登录</a></li>
            </ul>
        </div>

        <!-- 主内容区 -->
        <div class="main">
            <!-- 仪表板 -->
            <div id="dashboard" class="content-section active">
                <div class="header">
                    <h2>仪表板</h2>
                    <div class="user-info">
                        <span>欢迎，<strong id="currentUsername"></strong></span>
                        <button class="logout-btn" onclick="logout()">退出</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>平台总数</h3>
                        <div class="number" id="platformCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>文章总数</h3>
                        <div class="number" id="articleCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>已发布</h3>
                        <div class="number" id="publishedCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>进行中任务</h3>
                        <div class="number" id="activeTaskCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>总浏览量</h3>
                        <div class="number" id="totalViews">0</div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">🔧 系统状态</h3>
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 5px;">
                        <p>✅ 后端服务: <strong id="backendStatus">正常</strong></p>
                        <p>✅ 数据库: <strong id="dbStatus">正常</strong></p>
                        <p>✅ Redis缓存: <strong id="cacheStatus">正常</strong></p>
                        <p id="aiConfigStatus">🤖 AI 配置: <strong id="aiConfigStatusText">检查中...</strong></p>
                    </div>
                </div>
            </div>

            <!-- 栏目管理 -->
            <div id="sections" class="content-section">
                <div class="header">
                    <h2>栏目管理</h2>
                    <button class="btn btn-success" onclick="showSectionForm()">+ 新增栏目</button>
                </div>
                <div id="sectionsContent"></div>

                <!-- 栏目编辑模态框 -->
                <div id="sectionModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 id="sectionModalTitle">新增栏目</h2>
                            <button class="close-btn" onclick="closeSectionModal()">&times;</button>
                        </div>
                        <form id="sectionForm" onsubmit="saveSection(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>栏目名称 *</label>
                                    <input type="text" id="sectionName" required>
                                </div>
                                <div class="form-group">
                                    <label>栏目别名 *</label>
                                    <input type="text" id="sectionSlug" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>栏目描述</label>
                                <textarea id="sectionDescription" rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="sectionRequiresPlatform">
                                        需要关联平台
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>排序</label>
                                    <input type="number" id="sectionSortOrder" value="999">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="sectionIsActive" checked>
                                    启用
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">保存栏目</button>
                        </form>

                        <!-- 分类管理 -->
                        <div id="categoriesSection" style="display: none; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                            <h3>分类管理</h3>
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label>分类名称</label>
                                    <input type="text" id="newCategoryName" placeholder="输入分类名">
                                </div>
                                <button type="button" class="btn btn-success" onclick="addCategoryToSection()" style="margin-top: 25px;">+ 添加分类</button>
                            </div>
                            <div id="categoriesListContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 平台管理 -->
            <div id="platforms" class="content-section">
                <div class="header">
                    <h2>平台管理</h2>
                    <button class="btn btn-success" onclick="showPlatformForm()">+ 新增平台</button>
                </div>
                <div>
                    <input type="text" id="platformSearch" placeholder="搜索平台..." style="max-width: 300px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadPlatforms()">刷新</button>
                </div>
                <div id="platformsContent"></div>
            </div>

            <!-- Markdown 批量导入模态框 -->
            <div id="markdownImportModal" class="modal">
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>📁 批量导入 Markdown 文章</h2>
                        <button class="close-btn" onclick="closeMarkdownImportModal()">&times;</button>
                    </div>
                    <div style="padding: 20px;">
                        <!-- 栏目和分类选择 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label>目标栏目 *</label>
                                <select id="importSection" required onchange="onImportSectionChanged()">
                                    <option value="">-- 选择栏目 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>目标分类 *</label>
                                <select id="importCategory" required>
                                    <option value="">-- 先选择栏目 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" id="importPlatformGroup" style="display: none;">
                            <label>关联平台 *</label>
                            <select id="importPlatform">
                                <option value="">-- 选择平台 --</option>
                            </select>
                        </div>

                        <!-- 文件上传区域 -->
                        <div class="form-group">
                            <label>选择 Markdown 文件</label>
                            <div id="dropZone" style="border: 2px dashed #ccc; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #fafafa; transition: all 0.3s;"
                                 ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('mdFileInput').click()">
                                <div style="font-size: 48px; color: #999;">📄</div>
                                <p style="color: #666; margin: 10px 0;">拖拽 .md 文件到此处，或点击选择</p>
                                <p style="color: #999; font-size: 12px;">支持多选，单次最多 50 个文件</p>
                            </div>
                            <input type="file" id="mdFileInput" accept=".md,.markdown" multiple style="display: none;" onchange="handleFileSelect(event)">
                        </div>

                        <!-- 已选择的文件列表 -->
                        <div id="selectedFilesList" style="display: none; margin-top: 15px;">
                            <label>已选择的文件 (<span id="selectedFilesCount">0</span>个)</label>
                            <div id="filesListContent" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; padding: 10px; background: #f9f9f9;"></div>
                        </div>

                        <!-- 导入选项 -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="importAsPublished" checked>
                                <span>导入后直接发布</span>
                            </label>
                        </div>

                        <!-- 操作按钮 -->
                        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                            <button type="button" class="btn btn-secondary" onclick="closeMarkdownImportModal()">取消</button>
                            <button type="button" class="btn btn-success" id="startImportBtn" onclick="startMarkdownImport()" disabled>
                                开始导入 (<span id="importBtnCount">0</span>篇)
                            </button>
                        </div>

                        <!-- 导入进度 -->
                        <div id="importProgress" style="display: none; margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>导入进度</span>
                                <span id="importProgressText">0/0</span>
                            </div>
                            <div style="background: #e0e0e0; border-radius: 4px; height: 8px; overflow: hidden;">
                                <div id="importProgressBar" style="width: 0%; background: #4CAF50; height: 100%; transition: width 0.3s;"></div>
                            </div>
                            <div id="importLog" style="margin-top: 10px; max-height: 150px; overflow-y: auto; font-size: 12px; color: #666;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 平台编辑模态框 -->
            <div id="platformModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="platformModalTitle">新增平台</h2>
                        <button class="close-btn" onclick="closePlatformModal()">&times;</button>
                    </div>
                    <form id="platformForm" onsubmit="savePlatform(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>平台名称 *</label>
                                <input type="text" id="platformName" required>
                            </div>
                            <div class="form-group">
                                <label>官方网站 *</label>
                                <input type="url" id="platformUrl" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>评分</label>
                                <input type="number" id="platformRating" min="0" max="5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>排名</label>
                                <input type="number" id="platformRank" min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>最小杠杆</label>
                                <input type="number" id="platformMinLeverage" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>最大杠杆</label>
                                <input type="number" id="platformMaxLeverage" step="0.1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>描述</label>
                            <textarea id="platformDescription" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="platformRegulated">
                                    是否监管
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="platformActive">
                                    是否启用
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closePlatformModal()">取消</button>
                            <button type="submit" class="btn btn-primary">保存</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 文章管理 -->
            <div id="articles" class="content-section">
                <div class="header">
                    <h2>文章管理</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="showArticleForm()">+ 新增文章</button>
                        <button class="btn btn-primary" onclick="showMarkdownImportModal()">📁 批量导入 Markdown</button>
                    </div>
                </div>
                <div>
                    <input type="text" id="articleSearch" placeholder="搜索文章..." style="max-width: 300px; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadArticles()">刷新</button>
                </div>
                <div id="articlesContent"></div>
            </div>

            <!-- 文章编辑模态框 -->
            <div id="articleModal" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h2 id="articleModalTitle">新增文章</h2>
                        <button class="close-btn" onclick="closeArticleModal()">&times;</button>
                    </div>
                    <form id="articleForm" onsubmit="saveArticle(event)">
                        <input type="hidden" id="articleId" />
                        <div class="form-row full-width">
                            <div class="form-group">
                                <label>标题 *</label>
                                <input type="text" id="articleTitle" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>栏目 *</label>
                                <select id="articleSection" required onchange="onArticleSectionChanged()"></select>
                            </div>
                            <div class="form-group">
                                <label>分类 *</label>
                                <select id="articleCategory" required></select>
                            </div>
                        </div>
                        <!-- 条件显示的平台字段 (默认隐藏) -->
                        <div id="articlePlatformFieldGroup" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>所属平台 *</label>
                                    <select id="articlePlatform"></select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>摘要</label>
                            <textarea id="articleSummary" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>内容 *</label>
                            <!-- Tiptap 编辑器 -->
                            <div id="articleEditorToolbar" class="editor-toolbar"></div>
                            <div id="articleEditor" class="editor-container"></div>
                            <!-- 隐藏字段存储HTML内容 -->
                            <input type="hidden" id="articleContent" />
                        </div>
                        <!-- SEO 优化部分 -->
                        <div style="background: #f9f9fa; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #27ae60;">
                            <h4 style="margin-top: 0; color: #27ae60;">🔍 SEO 优化</h4>
                            <div class="form-group">
                                <label>SEO 标题 (推荐 50-60 字)</label>
                                <input type="text" id="articleSeoTitle" placeholder="不填则使用文章标题" maxlength="80">
                                <small style="color: #999;">用于浏览器标签栏和搜索引擎结果</small>
                            </div>
                            <div class="form-group">
                                <label>Meta 描述 (推荐 120-160 字)</label>
                                <textarea id="articleSeoDescription" rows="2" placeholder="用于搜索引擎结果摘要" maxlength="160"></textarea>
                                <small style="color: #999;">字数: <span id="seoDescCounter">0</span>/160</small>
                            </div>
                            <div class="form-group">
                                <label>关键词 (逗号分隔，推荐 3-5 个)</label>
                                <input type="text" id="articleSeoKeywords" placeholder="例: Python,交易,机器人" maxlength="200">
                                <small style="color: #999;">用于搜索引擎索引和相关性判断</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="articlePublished">
                                    立即发布
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="articleFeatured">
                                    精选文章
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeArticleModal()">取消</button>
                            <button type="submit" class="btn btn-primary">保存</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- AI任务 -->
            <div id="tasks" class="content-section">
                <div class="header">
                    <h2>AI生成任务</h2>
                </div>
                
                <!-- 生成任务表单 -->
                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>📝 批量生成文章</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>选择栏目 *</label>
                            <select id="taskSection" required onchange="onTaskSectionChanged()"></select>
                        </div>
                        <div class="form-group">
                            <label>选择分类 *</label>
                            <select id="taskCategory" required></select>
                        </div>
                        <div class="form-group">
                            <label>AI配置</label>
                            <select id="taskAIConfig">
                                <option value="">使用默认配置</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="taskPlatformGroup" style="display: none;">
                        <label>关联平台 *</label>
                        <select id="taskPlatform" required></select>
                    </div>
                    <div class="form-group">
                        <label>批量标题（每行一个） *</label>
                        <textarea id="taskTitles" rows="6" placeholder="Python 交易机器人入门&#10;如何使用 API 自动交易&#10;风险管理最佳实践" required></textarea>
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                            <input type="checkbox" id="taskAutoPublish" style="width: 18px; height: 18px; cursor: pointer;">
                            <span>🚀 生成后直接发布</span>
                            <small style="color: #666; font-size: 12px;">（不勾选则保存为草稿）</small>
                        </label>
                    </div>
                    <button class="btn btn-success" onclick="submitGenerationTask()">🚀 提交生成任务</button>
                </div>

                <!-- 任务列表 -->
                <h3>📋 任务历史</h3>
                <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>状态筛选</label>
                            <select id="taskStatus" style="width: 150px;">
                                <option value="">全部状态</option>
                                <option value="PENDING">待处理</option>
                                <option value="PROCESSING">处理中</option>
                                <option value="COMPLETED">已完成</option>
                                <option value="FAILED">已失败</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>开始日期</label>
                            <input type="date" id="taskStartDate" style="width: 150px;">
                        </div>
                        <div class="form-group">
                            <label>结束日期</label>
                            <input type="date" id="taskEndDate" style="width: 150px;">
                        </div>
                        <div class="form-group" style="padding-top: 22px;">
                            <button class="btn btn-primary" onclick="loadTasks()">🔍 查询</button>
                            <button class="btn btn-secondary" onclick="resetTaskFilters()" style="margin-left: 10px;">重置</button>
                        </div>
                    </div>
                </div>
                <div id="tasksContent"></div>
            </div>

            <!-- AI配置管理 -->
            <div id="ai-configs" class="content-section">
                <div class="header">
                    <h2>AI配置管理</h2>
                </div>
                
                <!-- 新建配置 -->
                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>➕ 新建AI配置</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>配置名称 *</label>
                            <input type="text" id="newConfigName" placeholder="例如：OpenAI-GPT4-Config" required>
                        </div>
                        <div class="form-group">
                            <label>服务商 *</label>
                            <select id="newConfigProvider" required>
                                <option value="">选择服务商</option>
                                <option value="OpenAI">OpenAI</option>
                                <option value="DeepSeek">DeepSeek</option>
                                <option value="Relay">中转链接</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>模型名称 *</label>
                            <input type="text" id="newConfigModel" placeholder="gpt-4" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>API端点 *</label>
                            <input type="url" id="newConfigEndpoint" placeholder="https://api.openai.com/v1/chat/completions" required>
                            <small style="color: #666; display: block; margin-top: 4px;">
                                💡 可简写为 https://api.openai.com，系统会自动补全路径
                            </small>
                        </div>
                        <div class="form-group">
                            <label>API密钥 *</label>
                            <input type="password" id="newConfigAPIKey" placeholder="sk-..." required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>系统提示词</label>
                        <textarea id="newConfigSystemPrompt" rows="3" placeholder="You are a helpful assistant..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>温度 (0-100)</label>
                            <input type="number" id="newConfigTemperature" min="0" max="100" step="1" value="7">
                        </div>
                        <div class="form-group">
                            <label>最大tokens</label>
                            <input type="number" id="newConfigMaxTokens" value="2000">
                        </div>
                        <div class="form-group">
                            <label>重试次数</label>
                            <input type="number" id="newConfigRetries" value="3" min="1">
                        </div>
                    </div>
                    
                    <!-- 按钮区域 - 左右分布 -->
                    <div class="button-row">
                        <div class="button-group-left">
                            <button type="button" class="btn btn-info" onclick="testAIConfig()">🧪 测试连接</button>
                            <div id="testStatus" class="test-status"></div>
                        </div>
                        <button class="btn btn-success" onclick="createAIConfig()">✅ 创建配置</button>
                    </div>
                </div>

                <!-- 配置列表 -->
                <h3>📋 已有配置</h3>
                <div id="aiConfigsContent"></div>
            </div>

            <!-- 系统设置 -->
            <div id="settings" class="content-section">
                <div class="header">
                    <h2>⚙️ 系统设置</h2>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px;">
                    <!-- 网站基本设置 -->
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h3>🌐 网站基本设置</h3>
                        <form id="websiteSettingsForm" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="siteName">网站名称 (用于标题后缀) *</label>
                                <input type="text" id="siteName" placeholder="如: 股票杠杆平台排行榜单">
                                <small style="color: #666;">页面标题将显示为: 页面标题 - 网站名称</small>
                            </div>
                            <div class="form-group">
                                <label for="siteTitle">首页标题 (Title)</label>
                                <input type="text" id="siteTitle" placeholder="首页SEO标题">
                            </div>
                            <div class="form-group">
                                <label for="siteDescription">网站描述 (Description)</label>
                                <textarea id="siteDescription" rows="3" placeholder="网站SEO描述，建议120字以内"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="siteKeywords">关键词 (Keywords)</label>
                                <input type="text" id="siteKeywords" placeholder="关键词，用英文逗号分隔">
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveWebsiteSettings()">💾 保存基本设置</button>
                        </form>
                    </div>

                    <!-- 流量统计设置 -->
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h3>📊 流量统计代码</h3>
                        <form id="analyticsSettingsForm" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="baiduAnalytics">百度统计代码</label>
                                <textarea id="baiduAnalytics" rows="4" placeholder="粘贴百度统计的完整script代码"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="googleAnalytics">Google Analytics代码</label>
                                <textarea id="googleAnalytics" rows="4" placeholder="粘贴Google Analytics的完整script代码"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="customScripts">自定义脚本 (放在head中)</label>
                                <textarea id="customScripts" rows="3" placeholder="其他需要在head中加载的脚本"></textarea>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveAnalyticsSettings()">💾 保存统计代码</button>
                        </form>
                    </div>

                    <!-- 备案与版权设置 -->
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h3>📜 备案与版权</h3>
                        <form id="footerSettingsForm" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="icpNumber">ICP备案号</label>
                                <input type="text" id="icpNumber" placeholder="如: 京ICP备xxxxxxxx号">
                                <small style="color: #666;">留空则不显示备案信息</small>
                            </div>
                            <div class="form-group">
                                <label for="companyName">公司/网站主体名称</label>
                                <input type="text" id="companyName" placeholder="版权归属名称">
                            </div>
                            <div class="form-group">
                                <label for="contactEmail">联系邮箱</label>
                                <input type="email" id="contactEmail" placeholder="support@example.com">
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveFooterSettings()">💾 保存备案信息</button>
                        </form>
                    </div>

                    <!-- 友情链接设置 -->
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h3>🔗 友情链接</h3>
                        <form id="footerLinksForm" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="footerLinks">友情链接 (JSON格式)</label>
                                <textarea id="footerLinks" rows="6" placeholder='[{"name":"链接名称","url":"https://example.com"}]'></textarea>
                                <small style="color: #666;">格式: [{"name":"名称","url":"地址"}, ...]</small>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveFooterLinks()">💾 保存友情链接</button>
                        </form>
                    </div>

                    <!-- 密码修改表单 -->
                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h3>🔐 修改管理员密码</h3>
                        <form id="changePasswordForm" style="margin-top: 20px;">
                            <div class="form-group">
                                <label for="oldPassword">旧密码 *</label>
                                <input type="password" id="oldPassword" placeholder="请输入当前密码" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">新密码 *</label>
                                <input type="password" id="newPassword" placeholder="请输入新密码 (至少8个字符)" required minlength="8">
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">确认新密码 *</label>
                                <input type="password" id="confirmPassword" placeholder="请再次输入新密码" required minlength="8">
                            </div>
                            <div id="passwordError" style="color: #e74c3c; margin-bottom: 10px; display: none;"></div>
                            <div id="passwordSuccess" style="color: #27ae60; margin-bottom: 10px; display: none;"></div>
                            <button type="button" class="btn btn-primary" onclick="changePassword()">✅ 更改密码</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin JavaScript (提取自内联脚本) -->
    <script src="/admin/assets/js/admin.js"></script>
    
    <!-- 隐藏的文件上传输入 -->
    <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
</body>
</html>
