<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰ç«¯æ¨¡å—åŠ è½½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. æ¨¡å—åŠ è½½çŠ¶æ€</h2>
        <div id="moduleStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>2. APIé…ç½®æµ‹è¯•</h2>
        <div id="apiConfigTest"></div>
    </div>
    
    <div class="test-section">
        <h2>3. APIå®¢æˆ·ç«¯æµ‹è¯•</h2>
        <button onclick="testHealthAPI()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
        <button onclick="testLoginAPI()">æµ‹è¯•ç™»å½•</button>
        <div id="apiTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. å·¥å…·å‡½æ•°æµ‹è¯•</h2>
        <button onclick="testDOMUtils()">æµ‹è¯•DOMå·¥å…·</button>
        <button onclick="testFormatUtils()">æµ‹è¯•æ ¼å¼åŒ–å·¥å…·</button>
        <button onclick="testUIUtils()">æµ‹è¯•UIç»„ä»¶</button>
        <div id="utilsTestResult"></div>
    </div>
    
    <script type="module">
        // å¯¼å…¥æ‰€æœ‰æ¨¡å—è¿›è¡Œæµ‹è¯•
        import { API_CONFIG, STORAGE_KEYS, USER_ROLES } from './js/config.js';
        import apiClient from './js/api-client.js';
        import authAPI from './js/api/auth.js';
        import articlesAPI from './js/api/articles.js';
        import { $, show, hide } from './js/utils/dom.js';
        import { showToast, showConfirm } from './js/utils/ui.js';
        import { formatDate, formatFileSize } from './js/utils/format.js';
        import { validateForm, validators } from './js/utils/validation.js';
        
        // æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸä¾›æŒ‰é’®è°ƒç”¨
        window.API_CONFIG = API_CONFIG;
        window.apiClient = apiClient;
        window.authAPI = authAPI;
        window.articlesAPI = articlesAPI;
        window.showToast = showToast;
        window.showConfirm = showConfirm;
        window.formatDate = formatDate;
        window.formatFileSize = formatFileSize;
        
        // 1. æ£€æŸ¥æ¨¡å—åŠ è½½çŠ¶æ€
        const moduleStatus = $('#moduleStatus');
        const modules = {
            'config.js': !!API_CONFIG,
            'api-client.js': !!apiClient,
            'api/auth.js': !!authAPI,
            'api/articles.js': !!articlesAPI,
            'utils/dom.js': typeof $ === 'function',
            'utils/ui.js': typeof showToast === 'function',
            'utils/format.js': typeof formatDate === 'function',
            'utils/validation.js': typeof validateForm === 'function'
        };
        
        let statusHTML = '<ul>';
        for (const [name, loaded] of Object.entries(modules)) {
            const icon = loaded ? 'âœ…' : 'âŒ';
            const className = loaded ? 'success' : 'error';
            statusHTML += `<li class="${className}">${icon} ${name}</li>`;
        }
        statusHTML += '</ul>';
        moduleStatus.innerHTML = statusHTML;
        
        // 2. æ˜¾ç¤ºAPIé…ç½®
        const apiConfigTest = $('#apiConfigTest');
        apiConfigTest.innerHTML = `
            <pre>${JSON.stringify({
                BASE_URL: API_CONFIG.BASE_URL,
                TIMEOUT: API_CONFIG.TIMEOUT,
                RETRY_TIMES: API_CONFIG.RETRY_TIMES
            }, null, 2)}</pre>
        `;
        
        // 3. APIæµ‹è¯•å‡½æ•°
        window.testHealthAPI = async function() {
            const result = $('#apiTestResult');
            try {
                result.innerHTML = '<p class="warning">â³ æ­£åœ¨æµ‹è¯•...</p>';
                const response = await apiClient.get('/api/health');
                result.innerHTML = `
                    <p class="success">âœ… å¥åº·æ£€æŸ¥æˆåŠŸ</p>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        };
        
        window.testLoginAPI = async function() {
            const result = $('#apiTestResult');
            try {
                result.innerHTML = '<p class="warning">â³ æ­£åœ¨æµ‹è¯•ç™»å½•...</p>';
                const response = await authAPI.login('admin', 'admin123');
                result.innerHTML = `
                    <p class="success">âœ… ç™»å½•æˆåŠŸ</p>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ ç™»å½•å¤±è´¥: ${error.message}</p>`;
            }
        };
        
        // 4. å·¥å…·å‡½æ•°æµ‹è¯•
        window.testDOMUtils = function() {
            const result = $('#utilsTestResult');
            const tests = [];
            
            // æµ‹è¯•é€‰æ‹©å™¨
            tests.push(`$ å‡½æ•°: ${typeof $ === 'function' ? 'âœ…' : 'âŒ'}`);
            tests.push(`é€‰æ‹©å™¨æµ‹è¯•: ${$('#utilsTestResult') === result ? 'âœ…' : 'âŒ'}`);
            
            result.innerHTML = `<ul>${tests.map(t => `<li>${t}</li>`).join('')}</ul>`;
        };
        
        window.testFormatUtils = function() {
            const result = $('#utilsTestResult');
            const now = new Date();
            const tests = [
                `æ—¥æœŸæ ¼å¼åŒ–: ${formatDate(now, 'YYYY-MM-DD HH:mm:ss')}`,
                `æ–‡ä»¶å¤§å°: ${formatFileSize(1024 * 1024 * 5.5)} (5.5MB)`,
            ];
            
            result.innerHTML = `<ul>${tests.map(t => `<li class="success">âœ… ${t}</li>`).join('')}</ul>`;
        };
        
        window.testUIUtils = async function() {
            showToast('è¿™æ˜¯ä¸€ä¸ªæˆåŠŸæç¤ºï¼', 'success');
            setTimeout(() => showToast('è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæç¤º', 'warning'), 1000);
            setTimeout(() => showToast('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯æç¤º', 'error'), 2000);
            
            const result = $('#utilsTestResult');
            result.innerHTML = '<p class="success">âœ… æŸ¥çœ‹å³ä¸Šè§’çš„Toastæç¤º</p>';
            
            // æµ‹è¯•ç¡®è®¤å¯¹è¯æ¡†
            setTimeout(async () => {
                const confirmed = await showConfirm('æµ‹è¯•ç¡®è®¤å¯¹è¯æ¡†ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ');
                result.innerHTML += `<p class="success">ç”¨æˆ·é€‰æ‹©: ${confirmed ? 'ç¡®å®š' : 'å–æ¶ˆ'}</p>`;
            }, 3000);
        };
        
        console.log('âœ… æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ');
        console.log('APIé…ç½®:', API_CONFIG);
    </script>
</body>
</html>
