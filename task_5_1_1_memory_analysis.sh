#!/bin/bash

# ============================================================================
# Task 5.1.1: æ·±åº¦å†…å­˜åˆ†æžè„šæœ¬
# ç”¨é€”: è‡ªåŠ¨åŒ–å†…å­˜åˆ†æžæµç¨‹ï¼Œç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
# ä½¿ç”¨: bash task_5_1_1_memory_analysis.sh
# ============================================================================

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          Task 5.1.1: æ·±åº¦å†…å­˜åˆ†æž - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

API_URL="http://localhost:8001"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
REPORT_FILE="MEMORY_PROFILING_REPORT_${TIMESTAMP}.md"

# åˆ›å»ºæŠ¥å‘Šæ–‡ä»¶
cat > "$REPORT_FILE" << 'EOF'
# ðŸ“Š å†…å­˜åˆ†æžæŠ¥å‘Š - Task 5.1.1

**ç”Ÿæˆæ—¶é—´**: 
**ç”Ÿæˆå·¥å…·**: task_5_1_1_memory_analysis.sh

---

## ðŸ“‹ æµ‹è¯•è¿‡ç¨‹

### åŸºå‡†å†…å­˜å ç”¨ (åˆå§‹)
```
[ç­‰å¾…æ•°æ®...]
```

### æ“ä½œåºåˆ—

#### 1. åŠ è½½é¦–é¡µ
**æ“ä½œ**: è®¿é—®åŽç«¯é¦–é¡µ
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

#### 2. åŠ è½½ç®¡ç†å‘˜åŽå°
**æ“ä½œ**: è®¿é—® /admin åŽå°
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

#### 3. åˆ›å»ºæ–‡ç« 
**æ“ä½œ**: åˆ›å»º 5 ç¯‡æ–‡ç« 
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

#### 4. ç¼–è¾‘æ–‡ç« 
**æ“ä½œ**: ç¼–è¾‘ 3 ç¯‡æ–‡ç« 
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

#### 5. ç”Ÿæˆ AI ä»»åŠ¡
**æ“ä½œ**: ç”Ÿæˆ 10 ä¸ª AI ä»»åŠ¡
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

#### 6. æ‰“å¼€/å…³é—­æ¨¡æ€æ¡†
**æ“ä½œ**: å¾ªçŽ¯æ‰“å¼€/å…³é—­ 10 ä¸ªæ¨¡æ€æ¡†
**æ—¶é—´**: [è®°å½•]
**å†…å­˜å¢žé•¿**: [ç­‰å¾…...]

---

## ðŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | è€—æ—¶ | å†…å­˜å¢žé•¿ | çŠ¶æ€ |
|------|------|---------|------|
| é¦–é¡µåŠ è½½ | - | - | â³ |
| åŽå°åŠ è½½ | - | - | â³ |
| åˆ›å»ºæ–‡ç«  | - | - | â³ |
| ç¼–è¾‘æ–‡ç«  | - | - | â³ |
| AI ä»»åŠ¡ | - | - | â³ |
| æ¨¡æ€æ¡† | - | - | â³ |

---

## ðŸ” å†…å­˜å¿«ç…§åˆ†æž

### å¿«ç…§ 1 (åˆå§‹)
```
æ—¶é—´: [è®°å½•]
å†…å­˜: [ç­‰å¾…...]
å¯¹è±¡: [ç­‰å¾…...]
```

### å¿«ç…§ 2 (ä¸­æœŸ)
```
æ—¶é—´: [è®°å½•]
å†…å­˜: [ç­‰å¾…...]
å¯¹è±¡: [ç­‰å¾…...]
å¢žé•¿: [è®¡ç®—...]
```

### å¿«ç…§ 3 (æœ€åŽ)
```
æ—¶é—´: [è®°å½•]
å†…å­˜: [ç­‰å¾…...]
å¯¹è±¡: [ç­‰å¾…...]
å¢žé•¿: [è®¡ç®—...]
```

---

## ðŸ“Š å†…å­˜æ³„æ¼åˆ†æž

### å‘çŽ°çš„æ³„æ¼

- â³ æ­£åœ¨åˆ†æž...

### çƒ­ç‚¹å‡½æ•°

- â³ æ­£åœ¨è¯†åˆ«...

### æ”¹è¿›å»ºè®®

- â³ ç­‰å¾…åˆ†æžç»“æžœ...

---

## âœ… éªŒæ”¶æ ‡å‡†

- [ ] å®Œæˆ 3 ä»½å†…å­˜å¿«ç…§
- [ ] è¯†åˆ«å†…å­˜æ³„æ¼çƒ­ç‚¹
- [ ] å†…å­˜å¢žé•¿ < 10MB (15åˆ†é’Ÿ)
- [ ] æå‡ºæ”¹è¿›æ–¹æ¡ˆ

---

## ðŸ“ æ³¨æ„äº‹é¡¹

1. ä½¿ç”¨ Chrome DevTools Memory Profiler è®°å½•å¿«ç…§
2. æ¯ä¸ªå¿«ç…§é—´éš”çº¦ 5-10 åˆ†é’Ÿ
3. é¿å…å…¶ä»–ç¨‹åºå ç”¨ç³»ç»Ÿèµ„æº
4. è®°å½•æ¯æ¬¡æ“ä½œçš„è€—æ—¶å’Œå†…å­˜å˜åŒ–

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. è¿›å…¥ Memory æ ‡ç­¾é¡µ
3. è®°å½•åŸºå‡†å†…å­˜å ç”¨
4. æ‰§è¡Œä¸Šè¿°æ“ä½œåºåˆ—
5. ç”Ÿæˆå†…å­˜å¿«ç…§
6. åˆ†æžå¿«ç…§å·®å¼‚

---

**çŠ¶æ€**: ðŸ“ ç­‰å¾…æ‰‹åŠ¨æµè§ˆå™¨æµ‹è¯•

EOF

echo "âœ… æŠ¥å‘Šæ–‡ä»¶å·²åˆ›å»º: $REPORT_FILE"
echo ""

# API æµ‹è¯•éƒ¨åˆ†
echo "ðŸ”§ å¼€å§‹ API æ€§èƒ½æµ‹è¯•..."
echo ""

# æµ‹è¯• API å“åº”æ—¶é—´
test_api_performance() {
    local endpoint=$1
    local description=$2
    
    echo "æµ‹è¯•: $description"
    
    START=$(date +%s%N | cut -b1-13)
    RESPONSE=$(curl -s "$API_URL$endpoint")
    END=$(date +%s%N | cut -b1-13)
    DURATION=$((END - START))
    
    echo "  â±ï¸  å“åº”æ—¶é—´: ${DURATION}ms"
    
    # æ£€æŸ¥å“åº”
    if echo "$RESPONSE" | grep -q "data\|error"; then
        echo "  âœ… å“åº”æ­£å¸¸"
    else
        echo "  âš ï¸  å“åº”å¼‚å¸¸"
    fi
    echo ""
}

# æµ‹è¯•å„ä¸ª API
test_api_performance "/api/sections" "èŽ·å–æ ç›®åˆ—è¡¨"
test_api_performance "/api/categories" "èŽ·å–åˆ†ç±»åˆ—è¡¨"
test_api_performance "/api/platforms" "èŽ·å–å¹³å°åˆ—è¡¨"
test_api_performance "/api/articles?skip=0&limit=10" "èŽ·å–æ–‡ç« åˆ—è¡¨"
test_api_performance "/api/health" "å¥åº·æ£€æŸ¥"

echo "ðŸ“Š API æµ‹è¯•å®Œæˆï¼"
echo ""

echo "ðŸ“ åŽç»­æ­¥éª¤:"
echo "   1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8001/admin"
echo "   2. æ‰“å¼€ Chrome DevTools (F12) â†’ Memory æ ‡ç­¾"
echo "   3. æ‰§è¡Œä¸Šè¿°æ“ä½œåºåˆ—ï¼Œè®°å½•å†…å­˜å¿«ç…§"
echo "   4. ç¼–è¾‘ $REPORT_FILE æ·»åŠ å¿«ç…§æ•°æ®"
echo "   5. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"
echo ""

echo "âœ¨ Task 5.1.1 åˆå§‹åŒ–å®Œæˆï¼"
