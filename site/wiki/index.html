<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary Meta Tags -->
    <title>百科知识库 - 鹰眼查融</title>
    <meta name="title" content="百科知识库 - 鹰眼查融">
    <meta name="description" content="融资融券与股票杠杆知识库，包含两融业务、保证金要求、风险指标、费率解析等相关文章。">
    <meta name="keywords" content="百科,知识库,融资融券,两融,保证金,杠杆交易">
    <meta name="robots" content="index, follow">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://www.yycr.net/wiki/">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    
    <!-- Main Stylesheet -->
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "首页", "item": "https://www.yycr.net/"},
            {"@type": "ListItem", "position": 2, "name": "百科"}
        ]
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": "杠杆交易百科知识库",
        "description": "关于杠杆交易、保证金、风险管理的完整知识库"
    }
    </script>
</head>
<body>
    
    <!-- Header / Navigation -->
    <header role="banner">
        <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" role="navigation" aria-label="主导航">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/" aria-label="鹰眼查融首页">
                    <span>鹰眼</span><span class="d-none d-sm-inline">查融</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="切换导航菜单">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/">首页</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/platforms/">平台</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/compare/">对比</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/qa/">常见问题</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle active" href="#" id="navbarResources" role="button" data-bs-toggle="dropdown" aria-expanded="false">资源</a>
                            <ul class="dropdown-menu" aria-labelledby="navbarResources">
                                <li><a class="dropdown-item active" href="/wiki/">百科</a></li>
                                <li><a class="dropdown-item" href="/guides/">指南</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/about/">关于</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="d-none d-md-block bg-light border-bottom py-2">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">首页</a></li>
                <li class="breadcrumb-item active" aria-current="page">百科知识库</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main role="main" id="main-content">
        <!-- Page Header with Background -->
        <section class="py-5 bg-light border-bottom">
            <div class="container">
                <h1 id="page-title" class="display-5 fw-bold mb-3">📚 百科知识库</h1>
                <p class="lead text-muted mb-0">
                    关于杠杆交易、风险管理和市场知识的综合学习资源。
                </p>
            </div>
        </section>

        <div class="container py-5">
            <!-- Search and Filter -->
            <section class="mb-5">
                <div class="input-group mb-3">
                    <span class="input-group-text bg-light border-end-0">🔍</span>
                    <input id="wiki-search-input" type="text" class="form-control border-start-0" placeholder="搜索百科文章...">
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-outline-primary btn-sm wiki-filter-btn" data-category="">全部</button>
                    <button class="btn btn-outline-secondary btn-sm wiki-filter-btn" data-category="基础概念">基础概念</button>
                    <button class="btn btn-outline-secondary btn-sm wiki-filter-btn" data-category="风险管理">风险管理</button>
                    <button class="btn btn-outline-secondary btn-sm wiki-filter-btn" data-category="交易平台">交易平台</button>
                    <button class="btn btn-outline-secondary btn-sm wiki-filter-btn" data-category="市场分析">市场分析</button>
                </div>
            </section>

            <!-- Wiki Articles Grid -->
                        <!-- Wiki Articles Grid -->
            <section class="mb-5" aria-labelledby="articles-title">
                <h2 id="articles-title" class="h5 mb-3">热门文章</h2>
                <div id="wiki-articles" class="row g-4">
                    <!-- 文章会动态生成 -->
                </div>
            </section>

            <!-- More Resources -->
            <section class="bg-light p-5 rounded">
                <h2 class="h4 mb-4">📖 按类别浏览</h2>
                <div class="accordion" id="categoriesAccordion">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#category1">
                                基础概念 (4 篇)
                            </button>
                        </h3>
                        <div id="category1" class="accordion-collapse collapse show" data-bs-parent="#categoriesAccordion">
                            <div class="accordion-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><a href="/article/what-is-leverage" class="text-decoration-none">什么是杠杆交易？</a></li>
                                    <li class="mb-2"><a href="/article/margin-call" class="text-decoration-none">什么是保证金追加？</a></li>
                                    <li class="mb-2"><a href="/article/leverage-ratio" class="text-decoration-none">杠杆比例的含义</a></li>
                                    <li><a href="/article/long-short" class="text-decoration-none">做多和做空交易</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#category2">
                                风险管理 (5 篇)
                            </button>
                        </h3>
                        <div id="category2" class="accordion-collapse collapse" data-bs-parent="#categoriesAccordion">
                            <div class="accordion-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><a href="/article/risk-metrics" class="text-decoration-none">关键风险指标</a></li>
                                    <li class="mb-2"><a href="/article/position-sizing" class="text-decoration-none">仓位管理</a></li>
                                    <li class="mb-2"><a href="/article/stop-loss-takeprofit" class="text-decoration-none">止损和获利订单</a></li>
                                    <li class="mb-2"><a href="/article/diversification" class="text-decoration-none">投资组合多元化</a></li>
                                    <li><a href="/article/risk-reward-ratio" class="text-decoration-none">风险收益比</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#category3">
                                市场分析 (4 篇)
                            </button>
                        </h3>
                        <div id="category3" class="accordion-collapse collapse" data-bs-parent="#categoriesAccordion">
                            <div class="accordion-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><a href="/article/technical-analysis" class="text-decoration-none">技术分析基础</a></li>
                                    <li class="mb-2"><a href="/article/support-resistance" class="text-decoration-none">支撑和阻力</a></li>
                                    <li class="mb-2"><a href="/article/candlestick-patterns" class="text-decoration-none">K 线图形态</a></li>
                                    <li><a href="/article/fundamental-analysis" class="text-decoration-none">基本面分析</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#category4">
                                交易平台 (3 篇)
                            </button>
                        </h3>
                        <div id="category4" class="accordion-collapse collapse" data-bs-parent="#categoriesAccordion">
                            <div class="accordion-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><a href="/article/fee-structure" class="text-decoration-none">费用结构详解</a></li>
                                    <li class="mb-2"><a href="/article/choosing-platform" class="text-decoration-none">如何选择交易平台</a></li>
                                    <li><a href="/article/platform-security" class="text-decoration-none">平台安全性</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5 mt-5" role="contentinfo" aria-label="页脚">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <h3 class="h6 mb-3">关于我们</h3>
                    <p class="small text-muted">
                        为投资者提供专业、透明的杠杆平台信息和交易指南。
                    </p>
                </div>
                <div class="col-md-4">
                    <h3 class="h6 mb-3">快速链接</h3>
                    <ul class="list-unstyled small">
                        <li><a href="/platforms/" class="text-decoration-none text-muted hover-primary">平台列表</a></li>
                        <li><a href="/wiki/" class="text-decoration-none text-muted hover-primary">百科知识</a></li>
                        <li><a href="/guides/" class="text-decoration-none text-muted hover-primary">交易指南</a></li>
                        <li><a href="/about/" class="text-decoration-none text-muted hover-primary">关于我们</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h3 class="h6 mb-3">联系我们</h3>
                    <p class="small text-muted mb-0">
                        Email: <a href="mailto:support@yycr.net" class="text-decoration-none text-muted hover-primary">support@yycr.net</a>
                    </p>
                </div>
            </div>
            <hr class="border-secondary my-4">
            <div class="text-center small text-muted">
                <p class="mb-1">
                    © 2025 上海薏雅征信。版权所有。
                </p>
                <p class="mb-0">
                    <a href="/legal/" class="text-decoration-none text-muted hover-primary">法律声明</a> | 
                    <a href="/legal/#disclaimer" class="text-decoration-none text-muted hover-primary">风险声明</a> | 
                    <span>更新时间：2025-10-21</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <!-- API Client -->
    <script src="/assets/js/api-client.js"></script>
    
    <!-- Wiki Search Script -->
    <script>
        // 从后端动态加载 Wiki 文章
        // 首先，硬编码的文章数据（作为后备方案）
        const wikiArticles = [
            {
                title: '什么是保证金追加（Margin Call）？',
                category: '基础概念',
                description: '理解保证金追加的含义、触发条件、风险和应对策略。',
                time: '5',
                url: '/article/margin-call',
                color: 'primary'
            },
            {
                title: '关键风险指标解读',
                category: '风险管理',
                description: '学习如何监测和理解杠杆交易中的关键风险指标。',
                time: '6',
                url: '/article/risk-metrics',
                color: 'info'
            },
            {
                title: '杠杆交易费用详解',
                category: '交易成本',
                description: '全面了解交易手续费、借款利息和其他隐含成本。',
                time: '7',
                url: '/article/fee-structure',
                color: 'success'
            },
            {
                title: '技术分析基础',
                category: '市场分析',
                description: '学习趋势、支撑/阻力和技术指标的基本概念。',
                time: '8',
                url: '/article/technical-analysis',
                color: 'warning'
            },
            {
                title: '仓位管理和杠杆比例',
                category: '风险管理',
                description: '如何选择合适的仓位大小和杠杆比例来控制风险。',
                time: '7',
                url: '/article/position-sizing',
                color: 'danger'
            },
            {
                title: '控制情绪交易',
                category: '交易心理',
                description: '克服恐惧和贪婪，建立有纪律的交易策略。',
                time: '6',
                url: '/wiki/emotions-trading/',
                color: 'secondary'
            }
        ];

        // 颜色映射（用于分类徽章）
        const categoryColorMap = {
            '基础概念': 'primary',
            '交易技巧': 'info',
            '市场分析': 'warning',
            '风险管理': 'danger',
            '平台对比': 'success',
            '交易成本': 'info',
            '交易心理': 'secondary',
            '交易平台': 'success'
        };

        // 从后端加载文章
        async function loadWikiArticlesFromBackend() {
            try {
                // 确定 API 基础 URL
                const apiUrl = window.location.hostname === 'localhost' 
                    ? `http://localhost:${window.location.port || 8000}`
                    : window.location.origin;
                
                // 从后端获取百科（wiki）栏目的文章
                const response = await fetch(`${apiUrl}/api/articles/by-section/wiki?limit=100`);
                
                if (!response.ok) {
                    console.warn('从后端加载文章失败，使用静态数据');
                    return wikiArticles;
                }
                
                const backendArticles = await response.json();
                
                if (!backendArticles || backendArticles.length === 0) {
                    console.warn('后端返回空文章列表，使用静态数据');
                    return wikiArticles;
                }
                
                // 将后端文章转换为前端格式
                return backendArticles.map(article => {
                    // 计算估计阅读时间（按 200 字/分钟）
                    const contentLength = (article.content || article.description || '').length;
                    const readTime = Math.max(1, Math.round(contentLength / 200));
                    
                    // 获取分类名称
                    const categoryName = article.category_name || article.category || '其他';
                    const color = categoryColorMap[categoryName] || 'secondary';
                    
                    return {
                        title: article.title,
                        category: categoryName,
                        description: article.summary || article.description || article.content?.substring(0, 100) || '暂无描述',
                        time: readTime,
                        // 使用文章 Slug 来跳转到详情页 (SEO 友好)
                        url: `/article/${article.slug}`,
                        color: color,
                        // 保存原始数据用于高级功能
                        id: article.id,
                        slug: article.slug,
                        viewCount: article.view_count || 0
                    };
                });
                
            } catch (error) {
                console.error('加载后端文章时出错:', error);
                return wikiArticles;
            }
        }
        
        // Wiki搜索和过滤功能
        const WikiSearch = {
            searchInput: document.getElementById('wiki-search-input'),
            filterButtons: document.querySelectorAll('.wiki-filter-btn'),
            articlesContainer: document.getElementById('wiki-articles'),
            
            currentCategory: '',
            currentSearch: '',
            allArticles: [],
            
            async init() {
                if (!this.searchInput || !this.articlesContainer) return;
                
                // 从后端加载文章
                this.allArticles = await loadWikiArticlesFromBackend();
                
                // 首先生成所有文章卡片
                this.renderArticles(this.allArticles);
                
                // 搜索事件
                this.searchInput.addEventListener('input', (e) => {
                    this.currentSearch = e.target.value.toLowerCase();
                    this.filterArticles();
                });
                
                // 分类过滤事件
                this.filterButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // 更新按钮状态
                        this.filterButtons.forEach(b => b.classList.remove('btn-outline-primary'));
                        this.filterButtons.forEach(b => b.classList.add('btn-outline-secondary'));
                        e.target.classList.remove('btn-outline-secondary');
                        e.target.classList.add('btn-outline-primary');
                        
                        this.currentCategory = e.target.dataset.category;
                        this.filterArticles();
                    });
                });
            },
            
            renderArticles(articles) {
                this.articlesContainer.innerHTML = articles.map(article => `
                    <div class="col-md-6 col-lg-4" data-article data-title="${article.title}" data-category="${article.category}" data-description="${article.description}">
                        <div class="card h-100 border-left border-${article.color}">
                            <div class="card-header bg-light">
                                <span class="badge bg-${article.color}">${article.category}</span>
                            </div>
                            <div class="card-body">
                                <h3 class="card-title h5">${article.title}</h3>
                                <p class="card-text text-muted small">${article.description}</p>
                            </div>
                            <div class="card-footer bg-transparent">
                                <small class="text-muted">⏱️ ${article.time} 分钟阅读</small>${article.viewCount ? `<small class="text-muted"> | 👁️ ${article.viewCount} 次浏览</small>` : ''}<br>
                                <a href="${article.url}" class="btn btn-sm btn-${article.color} mt-2">阅读全文</a>
                            </div>
                        </div>
                    </div>
                `).join('');
            },
            
            filterArticles() {
                // 重新渲染所有文章（确保文章元素存在）
                if (this.articlesContainer.querySelectorAll('[data-article]').length === 0) {
                    this.renderArticles(this.allArticles);
                }
                
                const articles = this.articlesContainer.querySelectorAll('[data-article]');
                let visibleCount = 0;
                
                // 移除之前的"无结果"提示
                const noResultMsg = this.articlesContainer.querySelector('.no-result-message');
                if (noResultMsg) noResultMsg.remove();
                
                articles.forEach(article => {
                    const title = article.dataset.title || '';
                    const category = article.dataset.category || '';
                    const description = article.dataset.description || '';
                    
                    // 检查是否与搜索和分类匹配
                    const matchesSearch = !this.currentSearch || 
                                         title.toLowerCase().includes(this.currentSearch) ||
                                         description.toLowerCase().includes(this.currentSearch);
                    const matchesCategory = !this.currentCategory || category === this.currentCategory;
                    
                    if (matchesSearch && matchesCategory) {
                        article.style.display = '';
                        visibleCount++;
                    } else {
                        article.style.display = 'none';
                    }
                });
                
                // 如果没有结果，显示提示（不替换原有元素）
                if (visibleCount === 0) {
                    const noResultDiv = document.createElement('div');
                    noResultDiv.className = 'col-12 text-center text-muted no-result-message';
                    noResultDiv.textContent = '未找到符合条件的文章';
                    this.articlesContainer.appendChild(noResultDiv);
                }
            }
        };
        
        // 页面加载完毕后初始化
        document.addEventListener('DOMContentLoaded', () => {
            WikiSearch.init();
        });
    </script>
    
    <!-- Main Script -->
    <script src="/assets/js/main.js" defer></script>
    <!-- Site Settings Loader -->
    <script src="/assets/js/site-settings.js" defer></script>
</body>
</html>
