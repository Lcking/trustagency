<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary Meta Tags -->
    <title>ä¸¤èæ•°æ®ä¸­å¿ƒ - èèµ„èåˆ¸å®æ—¶æ•°æ®æŸ¥è¯¢ | é¹°çœ¼æŸ¥è</title>
    <meta name="title" content="ä¸¤èæ•°æ®ä¸­å¿ƒ - èèµ„èåˆ¸å®æ—¶æ•°æ®æŸ¥è¯¢ | é¹°çœ¼æŸ¥è">
    <meta name="description" content="é¹°çœ¼æŸ¥èä¸¤èæ•°æ®ä¸­å¿ƒæä¾›æ²ªæ·±ä¸¤å¸‚èèµ„èåˆ¸å®æ—¶æ•°æ®ã€ä¸ªè‚¡ä¸¤èæŸ¥è¯¢ã€èèµ„å‡€ä¹°å…¥æ’è¡Œæ¦œï¼Œå¸®åŠ©æŠ•èµ„è€…æ´å¯Ÿå¸‚åœºèµ„é‡‘åŠ¨å‘ã€‚">
    <meta name="keywords" content="ä¸¤èæ•°æ®,èèµ„èåˆ¸,èèµ„ä½™é¢,èåˆ¸ä½™é‡,èèµ„ä¹°å…¥,ä¸¤èæ’è¡Œ,Aè‚¡ä¸¤è">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="author" content="é¹°çœ¼æŸ¥è">
    <meta name="language" content="zh-CN">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.yycr.net/margin/">
    <meta property="og:title" content="ä¸¤èæ•°æ®ä¸­å¿ƒ - èèµ„èåˆ¸å®æ—¶æ•°æ®æŸ¥è¯¢">
    <meta property="og:description" content="æ²ªæ·±ä¸¤å¸‚èèµ„èåˆ¸å®æ—¶æ•°æ®ã€ä¸ªè‚¡ä¸¤èæŸ¥è¯¢ã€èèµ„å‡€ä¹°å…¥æ’è¡Œæ¦œ">
    <meta property="og:locale" content="zh_CN">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.yycr.net/margin/">
    <meta property="twitter:title" content="ä¸¤èæ•°æ®ä¸­å¿ƒ - èèµ„èåˆ¸å®æ—¶æ•°æ®æŸ¥è¯¢">
    <meta property="twitter:description" content="æ²ªæ·±ä¸¤å¸‚èèµ„èåˆ¸å®æ—¶æ•°æ®ã€ä¸ªè‚¡ä¸¤èæŸ¥è¯¢ã€èèµ„å‡€ä¹°å…¥æ’è¡Œæ¦œ">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://www.yycr.net/margin/">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Main Stylesheet -->
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/utilities.css" rel="stylesheet">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Dataset",
        "name": "æ²ªæ·±ä¸¤å¸‚èèµ„èåˆ¸æ•°æ®",
        "description": "ä¸­å›½Aè‚¡å¸‚åœºæ¯æ—¥èèµ„èåˆ¸äº¤æ˜“æ±‡æ€»å’Œæ˜ç»†æ•°æ®ï¼ŒåŒ…å«èèµ„ä½™é¢ã€èåˆ¸ä½™é‡ã€èèµ„ä¹°å…¥é¢ç­‰æŒ‡æ ‡",
        "provider": {
            "@type": "Organization",
            "name": "é¹°çœ¼æŸ¥è",
            "url": "https://www.yycr.net"
        },
        "temporalCoverage": "2020-01-01/..",
        "spatialCoverage": "ä¸­å›½",
        "keywords": ["èèµ„èåˆ¸", "ä¸¤èæ•°æ®", "Aè‚¡", "èèµ„ä½™é¢", "èåˆ¸ä½™é‡"]
    }
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "é¦–é¡µ",
                "item": "https://www.yycr.net/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "ä¸¤èæ•°æ®",
                "item": "https://www.yycr.net/margin/"
            }
        ]
    }
    </script>

    <style>
        /* ä¸¤èæ•°æ®ä¸“ç”¨æ ·å¼ */
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        .stat-card.rzye { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card.rqye { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.rzrqye { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .stat-card.update { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .stat-change {
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        .stat-change.positive { color: #a8ffc4; }
        .stat-change.negative { color: #ffcdd2; }
        
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .ranking-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .ranking-table th {
            background: #f8f9fa;
            font-weight: 600;
            border: none;
        }
        .ranking-table td {
            vertical-align: middle;
        }
        .ranking-table .rank-badge {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
        }
        .rank-badge.rank-1 { background: linear-gradient(135deg, #ffd700, #ffb800); color: #5a4a00; }
        .rank-badge.rank-2 { background: linear-gradient(135deg, #e8e8e8, #c0c0c0); color: #444; }
        .rank-badge.rank-3 { background: linear-gradient(135deg, #deb887, #cd7f32); color: #fff; }
        .rank-badge.rank-default { background: #e9ecef; color: #495057; }
        
        .search-box {
            background: white;
            border-radius: 50px;
            padding: 0.5rem 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            padding: 0.5rem;
        }
        
        .value-positive { color: #28a745; }
        .value-negative { color: #dc3545; }
        
        .hero-margin {
            background: linear-gradient(135deg, var(--primary-color, #0d6efd) 0%, #0b5ed7 100%);
            color: white;
            padding: 3rem 0;
        }
        .hero-margin h1 {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .hero-margin .lead {
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    
    <!-- Header / Navigation -->
    <header role="banner">
        <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" role="navigation" aria-label="ä¸»å¯¼èˆª">
            <div class="container">
                <a class="navbar-brand fw-bold" href="/" aria-label="é¹°çœ¼æŸ¥èé¦–é¡µ">
                    <img src="/assets/images/logo.png" alt="é¹°çœ¼æŸ¥è" class="navbar-logo">
                    <span>é¹°çœ¼</span><span class="d-none d-sm-inline">æŸ¥è</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="åˆ‡æ¢å¯¼èˆªèœå•">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/">é¦–é¡µ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/margin/">ä¸¤è</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/platforms/">å¹³å°</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/compare/">å¯¹æ¯”</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/qa/">å¸¸è§é—®é¢˜</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarResources" role="button" data-bs-toggle="dropdown" aria-expanded="false">èµ„æº</a>
                            <ul class="dropdown-menu" aria-labelledby="navbarResources">
                                <li><a class="dropdown-item" href="/wiki/">ç™¾ç§‘</a></li>
                                <li><a class="dropdown-item" href="/guides/">æŒ‡å—</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/about/">å…³äº</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="d-none d-md-block bg-light border-bottom py-2">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">é¦–é¡µ</a></li>
                <li class="breadcrumb-item active" aria-current="page">ä¸¤èæ•°æ®</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main role="main" id="main-content">
        <!-- Hero Section -->
        <section class="hero-margin" aria-labelledby="hero-title">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1 id="hero-title" class="display-5 fw-bold mb-3">ğŸ“Š ä¸¤èæ•°æ®ä¸­å¿ƒ</h1>
                        <p class="lead mb-4" style="color: rgba(255,255,255,0.9);">
                            å®æ—¶è¿½è¸ªæ²ªæ·±ä¸¤å¸‚èèµ„èåˆ¸æ•°æ®ï¼Œæ´å¯Ÿå¸‚åœºèµ„é‡‘åŠ¨å‘ï¼ŒæŠŠæ¡æŠ•èµ„å…ˆæœº
                        </p>
                        <!-- æœç´¢æ¡† -->
                        <div class="search-box d-flex align-items-center" style="max-width: 500px;">
                            <span class="text-muted me-2">ğŸ”</span>
                            <input type="text" id="stockSearch" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°æœç´¢..." class="flex-grow-1">
                            <button class="btn btn-primary btn-sm rounded-pill px-4" onclick="searchStock()">æœç´¢</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
        <section class="py-5" aria-labelledby="stats-title">
            <div class="container">
                <h2 id="stats-title" class="visually-hidden">ä¸¤èæ•°æ®æ¦‚è§ˆ</h2>
                <div id="stats-container" class="row g-4">
                    <div class="col-6 col-lg-3">
                        <div class="stat-card rzye">
                            <div class="stat-value" id="stat-rzye">--</div>
                            <div class="stat-label">èèµ„ä½™é¢</div>
                            <div class="stat-change" id="stat-rzye-change">--</div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="stat-card rqye">
                            <div class="stat-value" id="stat-rqye">--</div>
                            <div class="stat-label">èåˆ¸ä½™é¢</div>
                            <div class="stat-change" id="stat-rqye-change">--</div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="stat-card rzrqye">
                            <div class="stat-value" id="stat-rzrqye">--</div>
                            <div class="stat-label">ä¸¤èä½™é¢</div>
                            <div class="stat-change" id="stat-rzrqye-change">--</div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="stat-card update">
                            <div class="stat-value" id="stat-date">--</div>
                            <div class="stat-label">æ•°æ®æ—¥æœŸ</div>
                            <div class="stat-change">æ¯æ—¥ 17:30 æ›´æ–°</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- è¶‹åŠ¿å›¾è¡¨ -->
        <section class="py-5 bg-light" aria-labelledby="trend-title">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 id="trend-title" class="mb-0">ğŸ“ˆ ä¸¤èä½™é¢è¶‹åŠ¿</h2>
                    <div class="btn-group" role="group" aria-label="æ—¶é—´èŒƒå›´">
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="loadTrend(7)">7å¤©</button>
                        <button type="button" class="btn btn-primary btn-sm active" onclick="loadTrend(30)">30å¤©</button>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="loadTrend(90)">90å¤©</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart" height="300"></canvas>
                </div>
            </div>
        </section>

        <!-- æ’è¡Œæ¦œ -->
        <section class="py-5" aria-labelledby="ranking-title">
            <div class="container">
                <h2 id="ranking-title" class="mb-4">ğŸ”¥ ä¸¤èæ’è¡Œæ¦œ</h2>
                <div class="row g-4">
                    <!-- èèµ„å‡€ä¹°å…¥ TOP10 -->
                    <div class="col-lg-6">
                        <div class="card ranking-table">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h3 class="h5 mb-0">ğŸ’° èèµ„å‡€ä¹°å…¥ TOP10</h3>
                                <a href="/margin/ranking/?order=net_buy" class="btn btn-sm btn-outline-primary">æŸ¥çœ‹æ›´å¤š</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th style="width: 50px;">æ’å</th>
                                                <th>è‚¡ç¥¨</th>
                                                <th class="text-end">å‡€ä¹°å…¥</th>
                                                <th class="text-end">èèµ„ä½™é¢</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ranking-net-buy">
                                            <tr><td colspan="4" class="text-center py-4"><div class="spinner-border spinner-border-sm text-primary"></div> åŠ è½½ä¸­...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- èåˆ¸ä½™é‡ TOP10 -->
                    <div class="col-lg-6">
                        <div class="card ranking-table">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h3 class="h5 mb-0">ğŸ“‰ èåˆ¸ä½™é‡ TOP10</h3>
                                <a href="/margin/ranking/?order=rqyl" class="btn btn-sm btn-outline-primary">æŸ¥çœ‹æ›´å¤š</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th style="width: 50px;">æ’å</th>
                                                <th>è‚¡ç¥¨</th>
                                                <th class="text-end">èåˆ¸ä½™é‡</th>
                                                <th class="text-end">èåˆ¸ä½™é¢</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ranking-rqyl">
                                            <tr><td colspan="4" class="text-center py-4"><div class="spinner-border spinner-border-sm text-primary"></div> åŠ è½½ä¸­...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸¤èçŸ¥è¯† -->
        <section class="py-5 bg-light" aria-labelledby="knowledge-title">
            <div class="container">
                <h2 id="knowledge-title" class="mb-4">ğŸ“š ä¸¤èçŸ¥è¯†</h2>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h3 class="card-title h6">ä»€ä¹ˆæ˜¯èèµ„èåˆ¸ï¼Ÿ</h3>
                                <p class="card-text small text-muted">èèµ„èåˆ¸æ˜¯æŒ‡æŠ•èµ„è€…å‘åˆ¸å•†å€Ÿå…¥èµ„é‡‘ä¹°å…¥è¯åˆ¸ï¼ˆèèµ„ï¼‰æˆ–å€Ÿå…¥è¯åˆ¸å–å‡ºï¼ˆèåˆ¸ï¼‰çš„äº¤æ˜“æ–¹å¼ã€‚</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h3 class="card-title h6">èèµ„ä½™é¢ä»£è¡¨ä»€ä¹ˆï¼Ÿ</h3>
                                <p class="card-text small text-muted">èèµ„ä½™é¢æ˜¯æŠ•èµ„è€…å°šæœªå¿è¿˜çš„èèµ„é‡‘é¢ï¼Œä½™é¢å¢åŠ é€šå¸¸è¡¨ç¤ºå¸‚åœºçœ‹å¤šæƒ…ç»ªä¸Šå‡ã€‚</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h3 class="card-title h6">èåˆ¸ä½™é‡çš„æ„ä¹‰ï¼Ÿ</h3>
                                <p class="card-text small text-muted">èåˆ¸ä½™é‡æ˜¯æŠ•èµ„è€…å°šæœªå½’è¿˜çš„å€Ÿå…¥è¯åˆ¸æ•°é‡ï¼Œä½™é‡å¢åŠ å¯èƒ½è¡¨ç¤ºå¸‚åœºçœ‹ç©ºæƒ…ç»ªå¢å¼ºã€‚</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h3 class="card-title h6">å¦‚ä½•åˆ†æä¸¤èæ•°æ®ï¼Ÿ</h3>
                                <p class="card-text small text-muted">ç»“åˆèèµ„å‡€ä¹°å…¥ã€èåˆ¸å˜åŒ–ã€ä»¥åŠä¸ªè‚¡èµ°åŠ¿ï¼Œå¯ä»¥è¾…åŠ©åˆ¤æ–­å¸‚åœºæƒ…ç»ªå’Œèµ„é‡‘æµå‘ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5 mt-5" role="contentinfo" aria-label="é¡µè„š">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <h3 class="h6 mb-3">å…³äºæˆ‘ä»¬</h3>
                    <p class="small text-muted">
                        é¹°çœ¼æŸ¥èä¸ºæŠ•èµ„è€…æä¾›ä¸“ä¸šçš„ä¸¤èæ•°æ®å’Œæ æ†å¹³å°ä¿¡æ¯æœåŠ¡ã€‚
                    </p>
                </div>
                <div class="col-md-4">
                    <h3 class="h6 mb-3">å¿«é€Ÿé“¾æ¥</h3>
                    <ul class="list-unstyled small">
                        <li><a href="/margin/" class="text-decoration-none text-muted">ä¸¤èæ•°æ®</a></li>
                        <li><a href="/platforms/" class="text-decoration-none text-muted">å¹³å°åˆ—è¡¨</a></li>
                        <li><a href="/compare/" class="text-decoration-none text-muted">å¹³å°å¯¹æ¯”</a></li>
                        <li><a href="/about/" class="text-decoration-none text-muted">å…³äºæˆ‘ä»¬</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h3 class="h6 mb-3">è”ç³»æˆ‘ä»¬</h3>
                    <p class="small text-muted mb-0">
                        Email: <a href="mailto:support@yycr.net" class="text-decoration-none text-muted">support@yycr.net</a>
                    </p>
                </div>
            </div>
            <hr class="border-secondary my-4">
            <div class="text-center small text-muted">
                <p class="mb-1">Â© 2025 ä¸Šæµ·è–é›…å¾ä¿¡ã€‚ç‰ˆæƒæ‰€æœ‰ã€‚</p>
                <p class="mb-0">
                    <a href="/legal/" class="text-decoration-none text-muted">æ³•å¾‹å£°æ˜</a> | 
                    <a href="/legal/#disclaimer" class="text-decoration-none text-muted">é£é™©å£°æ˜</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <!-- API Client -->
    <script src="/assets/js/api-client.js"></script>
    
    <script>
        // API åŸºç¡€URL
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8001'
            : '';
        
        // æ ¼å¼åŒ–é‡‘é¢ï¼ˆäº¿å…ƒï¼‰
        function formatAmount(value) {
            if (!value) return '--';
            const yi = value / 1e8;
            if (yi >= 10000) {
                return (yi / 10000).toFixed(2) + 'ä¸‡äº¿';
            }
            return yi.toFixed(2) + 'äº¿';
        }
        
        // æ ¼å¼åŒ–æ•°é‡ï¼ˆä¸‡è‚¡ï¼‰
        function formatVolume(value) {
            if (!value) return '--';
            const wan = value / 10000;
            if (wan >= 10000) {
                return (wan / 10000).toFixed(2) + 'äº¿è‚¡';
            }
            return wan.toFixed(0) + 'ä¸‡è‚¡';
        }
        
        // è·å–æ’åæ ·å¼
        function getRankClass(rank) {
            if (rank === 1) return 'rank-1';
            if (rank === 2) return 'rank-2';
            if (rank === 3) return 'rank-3';
            return 'rank-default';
        }
        
        // åŠ è½½æ¦‚è§ˆæ•°æ®
        async function loadOverview() {
            try {
                const response = await fetch(`${API_BASE}/api/margin/overview`);
                if (!response.ok) throw new Error('è·å–æ•°æ®å¤±è´¥');
                const data = await response.json();
                
                document.getElementById('stat-rzye').textContent = formatAmount(data.total_rzye);
                document.getElementById('stat-rqye').textContent = formatAmount(data.total_rqye);
                document.getElementById('stat-rzrqye').textContent = formatAmount(data.total_rzrqye);
                document.getElementById('stat-date').textContent = data.trade_date;
                
                // å˜åŒ–ç‡
                const formatChange = (val) => {
                    const sign = val >= 0 ? 'â†‘' : 'â†“';
                    const cls = val >= 0 ? 'positive' : 'negative';
                    return `<span class="${cls}">${sign} ${Math.abs(val).toFixed(2)}%</span>`;
                };
                
                document.getElementById('stat-rzye-change').innerHTML = formatChange(data.rzye_change);
                document.getElementById('stat-rqye-change').innerHTML = formatChange(data.rqye_change);
                document.getElementById('stat-rzrqye-change').innerHTML = formatChange(data.rzrqye_change);
                
            } catch (error) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', error);
            }
        }
        
        // å›¾è¡¨å®ä¾‹
        let trendChart = null;
        
        // åŠ è½½è¶‹åŠ¿æ•°æ®
        async function loadTrend(days = 30) {
            try {
                const response = await fetch(`${API_BASE}/api/margin/trend?days=${days}`);
                if (!response.ok) throw new Error('è·å–è¶‹åŠ¿æ•°æ®å¤±è´¥');
                const data = await response.json();
                
                const labels = data.data.map(d => d.date.slice(5)); // MM-DD
                const rzye = data.data.map(d => d.rzye / 1e8);
                const rqye = data.data.map(d => d.rqye / 1e8);
                const rzrqye = data.data.map(d => d.rzrqye / 1e8);
                
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                if (trendChart) {
                    trendChart.destroy();
                }
                
                trendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'èèµ„ä½™é¢(äº¿)',
                                data: rzye,
                                borderColor: '#f5576c',
                                backgroundColor: 'rgba(245, 87, 108, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'èåˆ¸ä½™é¢(äº¿)',
                                data: rqye,
                                borderColor: '#4facfe',
                                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'ä¸¤èä½™é¢(äº¿)',
                                data: rzrqye,
                                borderColor: '#43e97b',
                                backgroundColor: 'rgba(67, 233, 123, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(0) + 'äº¿';
                                    }
                                }
                            }
                        }
                    }
                });
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('[onclick^="loadTrend"]').forEach(btn => {
                    btn.classList.remove('btn-primary', 'active');
                    btn.classList.add('btn-outline-primary');
                    // æ£€æŸ¥æŒ‰é’®å¯¹åº”çš„å¤©æ•°
                    const btnDays = btn.getAttribute('onclick').match(/loadTrend\((\d+)\)/);
                    if (btnDays && parseInt(btnDays[1]) === days) {
                        btn.classList.remove('btn-outline-primary');
                        btn.classList.add('btn-primary', 'active');
                    }
                });
                
            } catch (error) {
                console.error('åŠ è½½è¶‹åŠ¿å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ’è¡Œæ¦œ
        async function loadRanking() {
            try {
                // èèµ„å‡€ä¹°å…¥
                const netBuyRes = await fetch(`${API_BASE}/api/margin/ranking?order_by=net_buy&limit=10`);
                if (netBuyRes.ok) {
                    const netBuyData = await netBuyRes.json();
                    renderRanking('ranking-net-buy', netBuyData.data, 'net_buy');
                }
                
                // èåˆ¸ä½™é‡
                const rqylRes = await fetch(`${API_BASE}/api/margin/ranking?order_by=rqyl&limit=10`);
                if (rqylRes.ok) {
                    const rqylData = await rqylRes.json();
                    renderRanking('ranking-rqyl', rqylData.data, 'rqyl');
                }
            } catch (error) {
                console.error('åŠ è½½æ’è¡Œæ¦œå¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“æ’è¡Œæ¦œ
        function renderRanking(containerId, data, type) {
            const container = document.getElementById(containerId);
            if (!data || data.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-muted">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            container.innerHTML = data.map((item, index) => {
                const rank = index + 1;
                const rankClass = getRankClass(rank);
                const code = item.ts_code.split('.')[0];
                
                if (type === 'net_buy') {
                    const netBuyClass = item.net_buy >= 0 ? 'value-positive' : 'value-negative';
                    const netBuySign = item.net_buy >= 0 ? '+' : '';
                    return `
                        <tr onclick="window.location.href='/margin/stock/?code=${item.ts_code}'" style="cursor: pointer;">
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                            <td>
                                <div class="fw-medium">${item.name || code}</div>
                                <small class="text-muted">${item.ts_code}</small>
                            </td>
                            <td class="text-end ${netBuyClass}">${netBuySign}${formatAmount(item.net_buy)}</td>
                            <td class="text-end">${formatAmount(item.rzye)}</td>
                        </tr>
                    `;
                } else {
                    return `
                        <tr onclick="window.location.href='/margin/stock/?code=${item.ts_code}'" style="cursor: pointer;">
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                            <td>
                                <div class="fw-medium">${item.name || code}</div>
                                <small class="text-muted">${item.ts_code}</small>
                            </td>
                            <td class="text-end">${formatVolume(item.rqyl)}</td>
                            <td class="text-end">${formatAmount(item.rqye)}</td>
                        </tr>
                    `;
                }
            }).join('');
        }
        
        // æœç´¢è‚¡ç¥¨
        function searchStock() {
            const keyword = document.getElementById('stockSearch').value.trim();
            if (keyword) {
                window.location.href = `/margin/stock/?code=${encodeURIComponent(keyword)}`;
            }
        }
        
        // å›è½¦æœç´¢
        document.getElementById('stockSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStock();
            }
        });
        
        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            loadOverview();
            loadTrend(30);
            loadRanking();
        });
    </script>
</body>
</html>
